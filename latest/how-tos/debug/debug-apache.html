

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Apache httpd tips &mdash; Open OnDemand 3.1.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/tabs.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Debugging Interactive Apps" href="debug-interactive-apps.html" />
    <link rel="prev" title="Debugging and Monitoring" href="../debug.html" />
 
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-34776817-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-34776817-3');
</script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/logo.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                3.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../requirements.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation/add-cluster-config.html">Cluster Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../app-development/interactive/setup.html">Setup Interactive Apps</a></li>
</ul>
<p class="caption"><span class="caption-text">How-Tos</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../customizations.html">Customizations</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../debug.html">Debugging and Monitoring</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Apache httpd tips</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#log-locations">Log locations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#restart-services">Restart services</a></li>
<li class="toctree-l3"><a class="reference internal" href="#show-virtualhosts">Show VirtualHosts</a></li>
<li class="toctree-l3"><a class="reference internal" href="#performance-tuning">Performance Tuning</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="debug-interactive-apps.html">Debugging Interactive Apps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../monitoring/logging.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../monitoring/prometheus.html">Prometheus Monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analytics/google-analytics.html">Adding Google Analytics</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../enable-desktops.html">Enable Interactive Desktop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../app-development.html">App Development</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install-ihpc-apps.html">Install Other Interactive Apps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/tutorials-interactive-apps.html">Tutorials: Interactive Apps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/tutorials-passenger-apps.html">Tutorials: Passenger Apps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/tutorials-dashboard-apps.html">Developing The OOD Dashboard</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference.html">Configuration Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../version-policy.html">Versioning Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Open OnDemand</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../debug.html">Debugging and Monitoring</a> &raquo;</li>
        
      <li>Apache httpd tips</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/OSC/ood-documentation/blob/latest/source/how-tos/debug/debug-apache.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="apache-httpd-tips">
<span id="apache-extra"></span><h1>Apache httpd tips<a class="headerlink" href="#apache-httpd-tips" title="Permalink to this headline">¶</a></h1>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>While this page is helpful it is no replacement for <a class="reference external" href="https://httpd.apache.org/docs/current/getting-started.html">Apache Httpd’s documentation</a>. If
you are an administrator responsible for Open OnDemand, you are now an administrator of
Apache Httpd as well.  As such, you should get comfortable with it as from time to time you will
have to troubleshoot it.</p>
</div>
<div class="section" id="log-locations">
<h2>Log locations<a class="headerlink" href="#log-locations" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../monitoring/logging.html#apache-logs"><span class="std std-ref">Information about apache log location.</span></a></p>
</div>
<div class="section" id="restart-services">
<span id="restart-apache"></span><h2>Restart services<a class="headerlink" href="#restart-services" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-0-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-0-0-0" name="0-0" role="tab" tabindex="0">RHEL/Rocky 8 &amp; 9</button><button aria-controls="panel-0-0-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-1" name="0-1" role="tab" tabindex="-1">Ubuntu &amp; Debian</button></div><div aria-labelledby="tab-0-0-0" class="sphinx-tabs-panel" id="panel-0-0-0" name="0-0" role="tabpanel" tabindex="0"><div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo systemctl try-restart httpd
</pre></div>
</div>
</div><div aria-labelledby="tab-0-0-1" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-1" name="0-1" role="tabpanel" tabindex="0"><div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo systemctl try-restart apache2
</pre></div>
</div>
</div></div>
</div></blockquote>
</div>
<div class="section" id="show-virtualhosts">
<span id="id1"></span><h2>Show VirtualHosts<a class="headerlink" href="#show-virtualhosts" title="Permalink to this headline">¶</a></h2>
<p>OpenOnDemand creates it’s own <a class="reference external" href="https://httpd.apache.org/docs/2.4/vhosts/">VirtualHost</a> in Apache.  Apache will route
requests based off of the hostname in the request to different VirtualHosts
and the ServerName you may have configured.</p>
<p>Showing virtualhosts can help debug Apache request routing.  The output from these
commands will show you how Apache is routing based off of the ServerName in the VirtualHost.</p>
<p>If you’re seeing the default Apache webpage you likely have to <a class="reference internal" href="../../reference/files/ood-portal-yml.html#ood-portal-generator-servername"><span class="std std-ref">configure the ServerName</span></a>
which corresponds directly to <a class="reference external" href="https://httpd.apache.org/docs/2.4/mod/core.html#servername">Apache’s ServerName configuration</a> (and restart Apache).</p>
<p>Or you’re using the wrong hostname in your browser.</p>
<blockquote>
<div><div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-1-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-1-1-0" name="1-0" role="tab" tabindex="0">RHEL/Rocky 8 &amp; 9</button><button aria-controls="panel-1-1-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-1-1-1" name="1-1" role="tab" tabindex="-1">Ubuntu &amp; Debian</button></div><div aria-labelledby="tab-1-1-0" class="sphinx-tabs-panel" id="panel-1-1-0" name="1-0" role="tabpanel" tabindex="0"><div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo /sbin/httpd -S
</pre></div>
</div>
</div><div aria-labelledby="tab-1-1-1" class="sphinx-tabs-panel" hidden="true" id="panel-1-1-1" name="1-1" role="tabpanel" tabindex="0"><div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>. /etc/apache2/envvars<span class="p">;</span> sudo -E /sbin/apache2 -S
</pre></div>
</div>
</div></div>
</div></blockquote>
</div>
<div class="section" id="performance-tuning">
<h2>Performance Tuning<a class="headerlink" href="#performance-tuning" title="Permalink to this headline">¶</a></h2>
<p>If you’re servicing many clients at time (more than 50) you will likely need to change the
<a class="reference external" href="https://httpd.apache.org/docs/2.4/mod/mpm_common.html">Apache Httpd’s MPM configuration</a>. The default configuration may degrade service when
Httpd has to serve many clients (I.e., when you have a lot of customers using Open OnDemand).</p>
<p>We suggest configurations similar to this.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The most important directives are <cite>MaxRequestWorkers</cite>, which controls the number of simultaneous
requests and <cite>ServerLimit</cite> combined with <cite>ThreadsPerChild</cite>, which when multiplied must be at least as big as
the value for <cite>MaxRequestWorkers</cite>.</p>
<p>It’s best to keep <cite>ServerLimit</cite> at or below the number of cores for the OnDemand web host.</p>
<p>The example configuration below can handle about 256 simultaneous requests.
Use this as an example and increase or decrease <cite>MaxRequestWorkers</cite> accordingly
(based on your resources, cpus &amp; memory and how much traffic you anticipate) then recalculate
<cite>ServerLimit</cite>, <cite>ThreadsPerChild</cite> and whatever else you may want to change.</p>
</div>
<div class="highlight-apache notranslate"><div class="highlight"><pre><span></span><span class="c"># conf.modules.d will vary depending on the platform and version.</span><span class="w"></span>
<span class="c"># $APACHE_HOME/conf.modules.d/mpm.conf</span><span class="w"></span>

<span class="c"># MPM event is actually important for idle VNC connections alive. You may</span><span class="w"></span>
<span class="c"># need delete occurences of mpm_prefork_module if you have that configured.</span><span class="w"></span>
<span class="nb">LoadModule</span><span class="w"> </span>mpm_event_module<span class="w"> </span>modules/mod_mpm_event.so<span class="w"></span>

<span class="nt">&lt;IfModule</span><span class="w"> </span><span class="s">mpm_event_module</span><span class="nt">&gt;</span><span class="w"></span>

<span class="w">  </span><span class="c"># ServerLimit is MaxRequestWorkers / ThreadsPerChild</span><span class="w"></span>
<span class="w">  </span><span class="nb">ServerLimit</span><span class="w">            </span><span class="m">8</span><span class="w"></span>
<span class="w">  </span><span class="nb">StartServers</span><span class="w">           </span><span class="m">2</span><span class="w"></span>
<span class="w">  </span><span class="nb">MaxRequestWorkers</span><span class="w">      </span><span class="m">256</span><span class="w"></span>
<span class="w">  </span><span class="nb">MinSpareThreads</span><span class="w">        </span><span class="m">25</span><span class="w"></span>
<span class="w">  </span><span class="nb">MaxSpareThreads</span><span class="w">        </span><span class="m">75</span><span class="w"></span>
<span class="w">  </span><span class="nb">ThreadsPerChild</span><span class="w">        </span><span class="m">32</span><span class="w"></span>
<span class="w">  </span><span class="nb">MaxRequestsPerChild</span><span class="w">    </span><span class="m">0</span><span class="w"></span>
<span class="w">  </span><span class="nb">ThreadLimit</span><span class="w">            </span><span class="m">256</span><span class="w"></span>
<span class="w">  </span><span class="nb">ListenBacklog</span><span class="w">          </span><span class="m">255</span><span class="w"></span>
<span class="nt">&lt;/IfModule&gt;</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="debug-interactive-apps.html" class="btn btn-neutral float-right" title="Debugging Interactive Apps" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../debug.html" class="btn btn-neutral float-left" title="Debugging and Monitoring" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017-2024, Ohio Supercomputer Center

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Documentation Versions</span>
    v: 
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Versions</dt>
      
        <dd><a href="https://OSC.github.io/ood-documentation/latest/how-tos/debug/debug-apache.html">latest</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-3.0/how-tos/debug/debug-apache.html">3.0</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-2.0/how-tos/debug/debug-apache.html">2.0</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.8/how-tos/debug/debug-apache.html">1.8</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.7/how-tos/debug/debug-apache.html">1.7</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.6/how-tos/debug/debug-apache.html">1.6</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.5/how-tos/debug/debug-apache.html">1.5</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.4/how-tos/debug/debug-apache.html">1.4</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.3/how-tos/debug/debug-apache.html">1.3</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.2/how-tos/debug/debug-apache.html">1.2</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.1/how-tos/debug/debug-apache.html">1.1</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.0/how-tos/debug/debug-apache.html">1.0</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/develop/how-tos/debug/debug-apache.html">develop</a></dd>
      
    </dl>
    <dl>
      <dt>On GitHub</dt>
        <dd>
          <a href="http://openondemand.org/">Website</a>
        </dd>
        <dd>
          <a href="https://github.com/OSC/Open-OnDemand">Main Repo</a>
        </dd>
    </dl>
    <hr/>
    Theme provided by <a href="http://www.readthedocs.org">Read the Docs</a>.
  </div>
</div>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>