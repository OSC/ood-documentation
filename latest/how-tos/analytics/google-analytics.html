

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Adding Google Analytics &mdash; Open OnDemand 3.1.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Enable Interactive Desktop" href="../../enable-desktops.html" />
    <link rel="prev" title="Prometheus Monitoring" href="../monitoring/prometheus.html" />
 
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-34776817-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-34776817-3');
</script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/logo.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                3.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../requirements.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation/add-cluster-config.html">Cluster Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../app-development/interactive/setup.html">Setup Interactive Apps</a></li>
</ul>
<p class="caption"><span class="caption-text">How-Tos</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../customizations.html">Customizations</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../debug.html">Debugging and Monitoring</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../debug/debug-apache.html">Apache httpd tips</a></li>
<li class="toctree-l2"><a class="reference internal" href="../debug/debug-interactive-apps.html">Debugging Interactive Apps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../monitoring/logging.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../monitoring/prometheus.html">Prometheus Monitoring</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Adding Google Analytics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#configure-open-ondemand">Configure Open OnDemand</a></li>
<li class="toctree-l3"><a class="reference internal" href="#querying-google-analytics">Querying Google Analytics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#more-info">More Info</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../enable-desktops.html">Enable Interactive Desktop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../app-development.html">App Development</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install-ihpc-apps.html">Install Other Interactive Apps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/tutorials-interactive-apps.html">Tutorials: Interactive Apps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/tutorials-passenger-apps.html">Tutorials: Passenger Apps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/tutorials-dashboard-apps.html">Developing The OOD Dashboard</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference.html">Configuration Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../version-policy.html">Versioning Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../issues/overview.html">OnDemand’s Known Issues</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Open OnDemand</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../debug.html">Debugging and Monitoring</a> &raquo;</li>
        
      <li>Adding Google Analytics</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/OSC/ood-documentation/blob/latest/source/how-tos/analytics/google-analytics.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="adding-google-analytics">
<span id="google-analytics"></span><h1>Adding Google Analytics<a class="headerlink" href="#adding-google-analytics" title="Permalink to this headline">¶</a></h1>
<p>If you wish you can setup your Open-OnDemand instance to send usage data to Google Analytics
(GA) that you can then query and report on, this page walks through how to do just that.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You’ll need to have a <a class="reference external" href="https://analytics.google.com/analytics/web">Google Analytics</a> account setup as a prerequisite to this.</p>
<p>To query GA You’ll need to have to have a service account setup with the appropriate permissions. See
info on <a class="reference external" href="https://cloud.google.com/iam/docs/service-accounts">Google service accounts</a> and <a class="reference external" href="https://cloud.google.com/iam/docs/understanding-roles">Google IAM roles</a> for more details on that.</p>
</div>
<div class="section" id="configure-open-ondemand">
<h2>Configure Open OnDemand<a class="headerlink" href="#configure-open-ondemand" title="Permalink to this headline">¶</a></h2>
<p>Refer to the <a class="reference internal" href="../../reference/files/ondemand-d-ymls.html#google-analytics-tag-id"><span class="std std-ref">ondemand.d configuration property google_analytics_tag_id</span></a>
on how to configure this feature.</p>
</div>
<div class="section" id="querying-google-analytics">
<h2>Querying Google Analytics<a class="headerlink" href="#querying-google-analytics" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This documentation is for GA version 3. With the newer versions of GA this may not
work as intended. As OSC does not use GA we’re unable to update these examples
ourselves, but would accept updates for the same.</p>
</div>
<p>Now that you have Open-OnDemand sending information to GA and it’s all configured correctly,
you can now query GA for this information, parse it and present it in any fashion you like.</p>
<p>Here’s a small portion of how we query GA in ruby, but there are many <a class="reference external" href="https://developers.google.com/analytics/devguides/reporting/core/v3/libraries">GA client libraries</a>
available.</p>
<p>This example is not complete and is only meant to illustrate how to query GA given the defined
metric set above. Let’s go through each of these things.</p>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="c1"># Dimensions - here we want dimensions 1, 3 and something called pagePath which is the web</span>
<span class="c1"># page requested. pagePath is a google predefined dimension that we populated. Dimensions 1</span>
<span class="c1"># and 3 were created above and are the username and timestamp (this is why the order in</span>
<span class="c1"># which they&#39;re defined is important).</span>
<span class="no">DIMENSIONS</span> <span class="o">=</span> <span class="sx">%w(</span>
<span class="sx">  ga:dimension3</span>
<span class="sx">  ga:dimension1</span>
<span class="sx">  ga:pagePath</span>
<span class="sx">)</span>

<span class="c1"># we only want to report the hit metrics</span>
<span class="no">METRICS</span>    <span class="o">=</span> <span class="sx">%w(</span>
<span class="sx">  ga:hits</span>
<span class="sx">)</span>

<span class="c1"># First we specify the host so that we only get metrics from a specific host. Secondly,</span>
<span class="c1"># we filter only only 200 responses (dimension6 is status code) and we don&#39;t want to</span>
<span class="c1"># report on file editor edits.</span>
<span class="no">FILTERS</span>    <span class="o">=</span> <span class="sx">%W(</span>
<span class="sx">  ga:hostname==</span><span class="si">#{</span><span class="no">HOST</span><span class="si">}</span><span class="sx">;ga:dimension6==200;ga:pagePath!=/pun/sys/file-editor/edit</span>
<span class="sx">)</span>

<span class="c1"># now we can create our analytics object and make the query</span>
<span class="n">analytics</span> <span class="o">=</span> <span class="no">Google</span><span class="o">::</span><span class="no">Apis</span><span class="o">::</span><span class="no">AnalyticsV3</span><span class="o">::</span><span class="no">AnalyticsService</span><span class="o">.</span><span class="n">new</span>

<span class="c1"># Here we query for the data that we want. A lot of things are omitted in this example</span>
<span class="c1"># for brevity like START_DATE (dynamic query times like the first day of the month)</span>
<span class="c1"># or GA_PROFILE (part of our credentials). And the fact that this is in a loop paginating</span>
<span class="c1"># the results, updating &#39;start_index&#39; and only requesting STEP_SIZE (10,000 in our case)</span>
<span class="c1"># results at a time.</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">analytics</span><span class="o">.</span><span class="n">get_ga_data</span><span class="p">(</span>
  <span class="s2">&quot;ga:</span><span class="si">#{</span><span class="no">GA_PROFILE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
  <span class="no">START_DATE</span><span class="p">,</span>
  <span class="no">END_DATE</span><span class="p">,</span>
  <span class="no">METRICS</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">),</span>
  <span class="ss">dimensions</span><span class="p">:</span>  <span class="no">DIMENSIONS</span><span class="o">.</span><span class="n">empty?</span> <span class="p">?</span> <span class="kp">nil</span> <span class="p">:</span> <span class="no">DIMENSIONS</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">),</span>
  <span class="ss">filters</span><span class="p">:</span>     <span class="no">FILTERS</span><span class="o">.</span><span class="n">empty?</span>    <span class="p">?</span> <span class="kp">nil</span> <span class="p">:</span> <span class="no">FILTERS</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">),</span>
  <span class="ss">sort</span><span class="p">:</span>        <span class="no">SORT</span><span class="o">.</span><span class="n">empty?</span>       <span class="p">?</span> <span class="kp">nil</span> <span class="p">:</span> <span class="no">SORT</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">),</span>
  <span class="ss">start_index</span><span class="p">:</span> <span class="n">start_index</span><span class="p">,</span>
  <span class="ss">max_results</span><span class="p">:</span> <span class="no">STEP_SIZE</span>
<span class="p">)</span>

<span class="n">target</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;my-report&#39;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>

<span class="c1"># now we can write out the results in a format that I want for my reporting.</span>
<span class="n">results</span><span class="o">.</span><span class="n">rows</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">row</span><span class="o">|</span>
  <span class="k">begin</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">row</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span>
    <span class="n">row</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="o">=</span> <span class="n">parse_uri</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="ss">user</span><span class="p">:</span> <span class="n">row</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">)</span>
    <span class="n">row</span> <span class="o">&lt;&lt;</span> <span class="n">app</span>
    <span class="n">target</span><span class="o">.</span><span class="n">write</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">row</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="more-info">
<h2>More Info<a class="headerlink" href="#more-info" title="Permalink to this headline">¶</a></h2>
<p>For reference, here’s more detailed information about implementations and protocols described
in this document.</p>
<p>See our <a class="reference external" href="https://github.com/OSC/ondemand/blob/master/mod_ood_proxy/lib/analytics.lua">analytics lua code</a> for the implementation of how we’re extracting this information,
parsing it and sending it to Google.</p>
<p>See the <a class="reference external" href="https://developers.google.com/analytics/devguides/collection/protocol/v1/reference">GA measurement protocol</a> for more details on the format we’re sending this data in.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../enable-desktops.html" class="btn btn-neutral float-right" title="Enable Interactive Desktop" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../monitoring/prometheus.html" class="btn btn-neutral float-left" title="Prometheus Monitoring" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017-2024, Ohio Supercomputer Center

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Documentation Versions</span>
    v: 
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Versions</dt>
      
        <dd><a href="https://OSC.github.io/ood-documentation/latest/how-tos/analytics/google-analytics.html">latest</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-3.0/how-tos/analytics/google-analytics.html">3.0</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-2.0/how-tos/analytics/google-analytics.html">2.0</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.8/how-tos/analytics/google-analytics.html">1.8</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.7/how-tos/analytics/google-analytics.html">1.7</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.6/how-tos/analytics/google-analytics.html">1.6</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.5/how-tos/analytics/google-analytics.html">1.5</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.4/how-tos/analytics/google-analytics.html">1.4</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.3/how-tos/analytics/google-analytics.html">1.3</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.2/how-tos/analytics/google-analytics.html">1.2</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.1/how-tos/analytics/google-analytics.html">1.1</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.0/how-tos/analytics/google-analytics.html">1.0</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/develop/how-tos/analytics/google-analytics.html">develop</a></dd>
      
    </dl>
    <dl>
      <dt>On GitHub</dt>
        <dd>
          <a href="http://openondemand.org/">Website</a>
        </dd>
        <dd>
          <a href="https://github.com/OSC/Open-OnDemand">Main Repo</a>
        </dd>
    </dl>
    <hr/>
    Theme provided by <a href="http://www.readthedocs.org">Read the Docs</a>.
  </div>
</div>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>