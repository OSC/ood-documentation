

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3. Enable Reverse Proxy &mdash; Open OnDemand 0.0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="author" title="About these documents"
              href="../about.html"/>
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Open OnDemand 0.0.1 documentation" href="../index.html"/>
        <link rel="up" title="Install Desktops" href="../install-desktops.html"/>
        <link rel="next" title="4. Install Desktop App" href="install-desktop-app.html"/>
        <link rel="prev" title="2. Modify Cluster Configuration" href="modify-cluster-configuration.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Open OnDemand
          

          
          </a>

          
            
            
              <div class="version">
                0.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../about.html">What is Open OnDemand</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting Started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../install-desktops.html">Install Desktops</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="software-requirements.html">1. Software Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="modify-cluster-configuration.html">2. Modify Cluster Configuration</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">3. Enable Reverse Proxy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#verify-it-works">3.1. Verify it Works</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="install-desktop-app.html">4. Install Desktop App</a></li>
<li class="toctree-l2"><a class="reference internal" href="customize-desktop-app.html">5. Customize Desktop App</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Components</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../infrastructure.html">Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications.html">Applications</a></li>
</ul>
<p class="caption"><span class="caption-text">Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user-documentation.html">User Documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Open OnDemand</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../install-desktops.html">Install Desktops</a> &raquo;</li>
        
      <li>3. Enable Reverse Proxy</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/install-desktops/enable-reverse-proxy.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="enable-reverse-proxy">
<span id="install-desktops-enable-reverse-proxy"></span><h1>3. Enable Reverse Proxy<a class="headerlink" href="#enable-reverse-proxy" title="Permalink to this headline">¶</a></h1>
<p>The reverse proxy will proxy a request to any specified host and port through
IP sockets. This is different than what is used for proxying to per-user NGINX
processes through Unix domain sockets. This can be used to connect to Jupyter
notebook servers, RStudio servers, VNC servers, and more… This is disabled by
default as it can be a security risk if not properly setup using a good
<code class="docutils literal"><span class="pre">host_regex</span></code>.</p>
<p>Requirements:</p>
<ul>
<li><p class="first">a regular expression that best describes all the hosts that you would want a
user to connect to through the proxy (e.g., <code class="docutils literal"><span class="pre">[\w.-]+\.osc\.edu</span></code>)</p>
</li>
<li><p class="first">confirm that if you run the command <code class="docutils literal"><span class="pre">hostname</span></code> from a compute node it will
return a string that matches the above regular expression</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>$ hostname
n0001.ten.osc.edu
</pre></div>
</div>
</li>
</ul>
<ol class="arabic">
<li><p class="first">We will update the Apache configuration file by adding <code class="docutils literal"><span class="pre">Location</span></code>
directives that will be used for the reverse proxy. This requires modifying
the configuration file for the <a class="reference internal" href="../infrastructure/ood-portal-generator.html#ood-portal-generator"><span class="std std-ref">ood-portal-generator</span></a>.</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span><span class="nb">cd</span> ~/ood/src/ood-portal-generator
</pre></div>
</div>
</li>
<li><p class="first"><a class="reference internal" href="../infrastructure/ood-portal-generator/configuration.html#ood-portal-generator-configuration"><span class="std std-ref">Configuration</span></a> is handled by editing the
<code class="docutils literal"><span class="pre">config.yml</span></code> as such:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="c1"># ...</span>
<span class="c1"># ... any other configuration options you had from before ...</span>
<span class="c1"># ...</span>

<span class="l l-Scalar l-Scalar-Plain">host_regex</span><span class="p p-Indicator">:</span> <span class="s">&quot;[\\w.-]+\\.osc\\.edu&quot;</span>
<span class="l l-Scalar l-Scalar-Plain">node_uri</span><span class="p p-Indicator">:</span> <span class="s">&quot;/node&quot;</span>
<span class="l l-Scalar l-Scalar-Plain">rnode_uri</span><span class="p p-Indicator">:</span> <span class="s">&quot;/rnode&quot;</span>
</pre></div>
</div>
<p>You can read more about these options under
<a class="reference internal" href="../infrastructure/ood-portal-generator/configuration.html#ood-portal-generator-configuration-configure-reverse-proxy"><span class="std std-ref">Configure Reverse Proxy</span></a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Since we use double quotes in the YAML file to wrap the regular
expression, we will need to escape the blackslashes, so <code class="docutils literal"><span class="pre">\w</span></code> becomes
<code class="docutils literal"><span class="pre">\\w</span></code>. If you use single quotes, you will not need to escape them.</p>
</div>
</li>
<li><p class="first">Re-build the Apache config:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>scl <span class="nb">enable</span> rh-ruby22 -- rake
</pre></div>
</div>
</li>
<li><p class="first">Copy it over to the default location:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>sudo scl <span class="nb">enable</span> rh-ruby22 -- rake install
</pre></div>
</div>
</li>
<li><p class="first">Restart the Apache server:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>sudo service httpd24-httpd restart
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>If using <strong>RHEL 7</strong> you will need to replace the above command with:</p>
<div class="last highlight-sh"><div class="highlight"><pre><span></span>sudo systemctl restart httpd24-httpd
</pre></div>
</div>
</div>
</li>
</ol>
<div class="section" id="verify-it-works">
<h2>3.1. Verify it Works<a class="headerlink" href="#verify-it-works" title="Permalink to this headline">¶</a></h2>
<p>We can test that the reverse proxy is now functional by starting up a simple
server on a compute node and connecting to it through the proxy with our
browser.</p>
<ol class="arabic">
<li><p class="first">SSH to any compute node that matches the regular expression above:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>ssh n0001.ten.osc.edu
</pre></div>
</div>
</li>
<li><p class="first">Start up a very simple listening server on a high number port:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>nc -l <span class="m">5432</span>
</pre></div>
</div>
</li>
<li><p class="first">In your browser navigate to this server using the Apache reverse proxy with
the following URL format:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ondemand</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">edu</span><span class="o">/</span><span class="n">node</span><span class="o">/&lt;</span><span class="n">host</span><span class="o">&gt;/&lt;</span><span class="n">port</span><span class="o">&gt;/...</span>
</pre></div>
</div>
<p>So for our simplified case lets use:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ondemand</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">edu</span><span class="o">/</span><span class="n">node</span><span class="o">/</span><span class="n">n0001</span><span class="o">.</span><span class="n">ten</span><span class="o">.</span><span class="n">osc</span><span class="o">.</span><span class="n">edu</span><span class="o">/</span><span class="mi">5432</span><span class="o">/</span>
</pre></div>
</div>
</li>
<li><p class="first">Go back to your SSH session and verify that it received the browser
request:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">GET</span> <span class="o">/</span><span class="n">node</span><span class="o">/</span><span class="n">n0691</span><span class="o">.</span><span class="n">ten</span><span class="o">.</span><span class="n">osc</span><span class="o">.</span><span class="n">edu</span><span class="o">/</span><span class="mi">5432</span><span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<span class="n">Host</span><span class="p">:</span> <span class="n">n0691</span><span class="o">.</span><span class="n">ten</span><span class="o">.</span><span class="n">osc</span><span class="o">.</span><span class="n">edu</span><span class="p">:</span><span class="mi">5432</span>
<span class="n">Upgrade</span><span class="o">-</span><span class="n">Insecure</span><span class="o">-</span><span class="n">Requests</span><span class="p">:</span> <span class="mi">1</span>
<span class="o">...</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>As we don’t have the simple server return anything to the browser, you
can ignore any errors or warnings you see in your browser.</p>
<p class="last">You can get fancier using a Python <code class="docutils literal"><span class="pre">SimpleHTTPServer</span></code>, but we leave
that as an exercise to the reader.</p>
</div>
</li>
</ol>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="install-desktop-app.html" class="btn btn-neutral float-right" title="4. Install Desktop App" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="modify-cluster-configuration.html" class="btn btn-neutral" title="2. Modify Cluster Configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Ohio Supercomputer Center.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>