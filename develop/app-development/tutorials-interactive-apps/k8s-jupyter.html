

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Add a Jupyter App on a Kubernetes Cluster &mdash; Open OnDemand 2.0.20 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Add a Jupyter App on a Kubernetes Cluster that behaves like HPC compute" href="k8s-like-hpc-jupyter.html" />
    <link rel="prev" title="8. Known Issues" href="add-matlab/known-issues.html" />
 
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-34776817-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-34776817-3');
</script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/logo.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">General</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference.html">Configuration Reference</a></li>
</ul>
<p class="caption"><span class="caption-text">Install</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../requirements.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../authentication.html">Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation/add-cluster-config.html">Add Cluster Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation/resource-manager.html">Resource Manager Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../customization_overview.html">Customization Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../customization.html">Customization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analytics.html">Analytics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../monitoring.html">Monitoring</a></li>
</ul>
<p class="caption"><span class="caption-text">Extend</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../interactive/setup.html">Setup Interactive Apps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../enable-desktops.html">Enable Interactive Desktop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install-ihpc-apps.html">Install Other Interactive Apps</a></li>
</ul>
<p class="caption"><span class="caption-text">Deploy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../app-authorization.html">App Authorization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app-sharing.html">App Sharing</a></li>
</ul>
<p class="caption"><span class="caption-text">Develop Interactive Apps</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../app-development.html">App Development</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials-interactive-apps.html">Tutorials: Interactive Apps</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="add-jupyter.html">Add a Jupyter App</a></li>
<li class="toctree-l2"><a class="reference internal" href="add-rstudio.html">Add an RStudio App</a></li>
<li class="toctree-l2"><a class="reference internal" href="add-matlab.html">Add a MATLAB App</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Add a Jupyter App on a Kubernetes Cluster</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#container-spec">container spec</a></li>
<li class="toctree-l3"><a class="reference internal" href="#resource-requests">resource requests</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configmap">configmap</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mounts">mounts</a></li>
<li class="toctree-l3"><a class="reference internal" href="#init-containers">init containers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#submit-yml-in-full">submit yml in full</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="k8s-like-hpc-jupyter.html">Add a Jupyter App on a Kubernetes Cluster that behaves like HPC compute</a></li>
<li class="toctree-l2"><a class="reference internal" href="add-custom-queue.html">Add Custom Queues/Partitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html">Troubleshooting Interactive Apps</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Develop Passenger Apps</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials-passenger-apps.html">Tutorials: Passenger Apps</a></li>
</ul>
<p class="caption"><span class="caption-text">Release Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes/v2.1-release-notes.html">v2.1 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes/v2.0-release-notes.html">v2.0 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes/v1.8-release-notes.html">v1.8 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes/v1.7-release-notes.html">v1.7 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes/v1.6-release-notes.html">v1.6 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes/v1.5-release-notes.html">v1.5 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes/v1.4-release-notes.html">v1.4 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes/v1.3-release-notes.html">v1.3 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes/v1.2-release-notes.html">v1.2 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes/v1.1-release-notes.html">v1.1 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes/v1.0-release-notes.html">v1.0 Release Notes</a></li>
</ul>
<p class="caption"><span class="caption-text">Known Issues</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../issues/overview.html">OnDemand’s Known Issues</a></li>
</ul>
<p class="caption"><span class="caption-text">Legacy Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../applications.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user-documentation.html">User Documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Open OnDemand</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../tutorials-interactive-apps.html">Tutorials: Interactive Apps</a> &raquo;</li>
        
      <li>Add a Jupyter App on a Kubernetes Cluster</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/OSC/ood-documentation/blob/develop/source/app-development/tutorials-interactive-apps/k8s-jupyter.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="add-a-jupyter-app-on-a-kubernetes-cluster">
<span id="app-development-tutorials-interactive-apps-k8s-jupyter"></span><h1>Add a Jupyter App on a Kubernetes Cluster<a class="headerlink" href="#add-a-jupyter-app-on-a-kubernetes-cluster" title="Permalink to this headline">¶</a></h1>
<p>This tutorial will walk you through creating an interactive Jupyter app that
your users will use to launch a <a class="reference external" href="http://jupyter.readthedocs.io/en/latest/">Jupyter Notebook Server</a> in a kubernetes cluster.</p>
<p>It assumes you have a working understanding of app development already. The purpose of
this document is to describe how to write apps specifically for a kubernetes cluster,
so it skips a lot of important details about app development that may be found in
other tutorials like <a class="reference internal" href="add-jupyter.html#app-development-tutorials-interactive-apps-add-jupyter"><span class="std std-ref">Add a Jupyter App</span></a>.</p>
<p>We’re going to be looking at the <a class="reference external" href="https://github.com/OSC/bc_k8s_jupyter">bc k8s jupyter</a> app which you can fork, clone
and modify for your site.  This page also holds the <a class="reference internal" href="#submit-yml-in-full">submit yml in full</a> for reference.</p>
<p>Refer to <a class="reference internal" href="k8s-like-hpc-jupyter.html#app-development-tutorials-interactive-apps-k8s-like-hpc-jupyter"><span class="std std-ref">interactive K8s Jupyter using HPC-like containers</span></a>
for details on running Jupyter on Kubernetes with containers that behave more like traditional
HPC jobs.</p>
<div class="section" id="container-spec">
<h2>container spec<a class="headerlink" href="#container-spec" title="Permalink to this headline">¶</a></h2>
<p>Let’s look at this section first.  Here you must specify the <code class="docutils literal notranslate"><span class="pre">name</span></code>, <code class="docutils literal notranslate"><span class="pre">image</span></code>
and <code class="docutils literal notranslate"><span class="pre">command</span></code>.  The name determines the Pod Id (the job name in HPC parlance).</p>
<p><code class="docutils literal notranslate"><span class="pre">working_dir</span></code> is the working directory of the container. This is optional as
a container may specify this.  <code class="docutils literal notranslate"><span class="pre">restart_policy</span></code> is also optional and is Never
by default.</p>
<p>Next you can specify additional environment variables in <code class="docutils literal notranslate"><span class="pre">env</span></code>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">container</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;jupyter&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="s">&quot;docker-registry.osc.edu/ondemand/scipy-notebook:python-3.9.2&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">command</span><span class="p p-Indicator">:</span> <span class="s">&quot;/usr/local/bin/start.sh</span><span class="nv"> </span><span class="s">/opt/conda/bin/jupyter</span><span class="nv"> </span><span class="s">notebook</span><span class="nv"> </span><span class="s">--config=/ood/ondemand_config.py&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">working_dir</span><span class="p p-Indicator">:</span> <span class="s">&quot;&lt;%=</span><span class="nv"> </span><span class="s">Etc.getpwnam(ENV[&#39;USER&#39;]).dir</span><span class="nv"> </span><span class="s">%&gt;&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">restart_policy</span><span class="p p-Indicator">:</span> <span class="s">&#39;OnFailure&#39;</span>
  <span class="l l-Scalar l-Scalar-Plain">env</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">NB_UID</span><span class="p p-Indicator">:</span> <span class="s">&quot;&lt;%=</span><span class="nv"> </span><span class="s">user.uid</span><span class="nv"> </span><span class="s">%&gt;&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">NB_USER</span><span class="p p-Indicator">:</span> <span class="s">&quot;&lt;%=</span><span class="nv"> </span><span class="s">user.name</span><span class="nv"> </span><span class="s">%&gt;&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">NB_GID</span><span class="p p-Indicator">:</span> <span class="s">&quot;&lt;%=</span><span class="nv"> </span><span class="s">user.group.id</span><span class="nv"> </span><span class="s">%&gt;&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">HOME</span><span class="p p-Indicator">:</span> <span class="s">&quot;&lt;%=</span><span class="nv"> </span><span class="s">user.home</span><span class="nv"> </span><span class="s">%&gt;&quot;</span>
</pre></div>
</div>
<p>Here is the default environment. You can use a <code class="docutils literal notranslate"><span class="pre">null</span></code> here to unset any of these.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>USER: username,
UID: run_as_user,
HOME: home_dir,
GROUP: group,
GID: run_as_group,
KUBECONFIG: &#39;/dev/null&#39;
</pre></div>
</div>
</div>
<div class="section" id="resource-requests">
<h2>resource requests<a class="headerlink" href="#resource-requests" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">port</span></code> is is the port the container is going to listen on.  <code class="docutils literal notranslate"><span class="pre">cpu</span></code> and <code class="docutils literal notranslate"><span class="pre">memory</span></code>
are the cpu and memory request. Note that memory here has <code class="docutils literal notranslate"><span class="pre">Gi</span></code> which is the unit.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">container</span><span class="p p-Indicator">:</span>
  <span class="c1"># ...</span>
  <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="s">&quot;8080&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">cpu</span><span class="p p-Indicator">:</span> <span class="s">&quot;&lt;%=</span><span class="nv"> </span><span class="s">cpu</span><span class="nv"> </span><span class="s">%&gt;&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">memory</span><span class="p p-Indicator">:</span> <span class="s">&quot;&lt;%=</span><span class="nv"> </span><span class="s">memory</span><span class="nv"> </span><span class="s">%&gt;Gi&quot;</span>
</pre></div>
</div>
<p>Kubernetes has some flexibility in requests. One can make _requests_ and _limits_
which are like hard and soft limits. In the example above, they’re both the same.</p>
<p>Here’s an example utilizing requests and limits for both memory and cpu. Note that
we’re using millicores in <code class="docutils literal notranslate"><span class="pre">cpu_request</span></code>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">container</span><span class="p p-Indicator">:</span>
  <span class="c1"># ...</span>
  <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="s">&quot;8080&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">cpu_request</span><span class="p p-Indicator">:</span> <span class="s">&quot;0.200&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">cpu_limit</span><span class="p p-Indicator">:</span> <span class="s">&quot;4&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">memory_request</span><span class="p p-Indicator">:</span> <span class="s">&quot;500Mi&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">memory_limit</span><span class="p p-Indicator">:</span> <span class="s">&quot;4Gi&quot;</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://kubernetes.io/docs/tasks/configure-pod-container/assign-memory-resource/">kubernetes pod memory</a> and <a class="reference external" href="https://kubernetes.io/docs/tasks/configure-pod-container/assign-memory-resource/">kubernetes pod cpu</a> for more details.</p>
</div>
<div class="section" id="configmap">
<h2>configmap<a class="headerlink" href="#configmap" title="Permalink to this headline">¶</a></h2>
<p>A <a class="reference external" href="https://kubernetes.io/docs/concepts/configuration/configmap/">Kubernetes configmap</a> is a way to apply configurations to a container.
In this example, we’re using a configmap to generate the config file for
Jupyter.  We’ll see later how we use init containers to update it, but let’s
see how we initialize it.</p>
<p>You need to specify <code class="docutils literal notranslate"><span class="pre">filename</span></code> which is the name of the file. <code class="docutils literal notranslate"><span class="pre">data</span></code> is
the contents of the file.  <code class="docutils literal notranslate"><span class="pre">mount_path</span></code> is the directory in the container
the file will be mounted to.  <code class="docutils literal notranslate"><span class="pre">files</span></code> here is an array so you can add many
files to a single configmap.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">configmap</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">files</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">filename</span><span class="p p-Indicator">:</span> <span class="s">&quot;&lt;%=</span><span class="nv"> </span><span class="s">configmap_filename</span><span class="nv"> </span><span class="s">%&gt;&quot;</span>
      <span class="l l-Scalar l-Scalar-Plain">data</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
        <span class="no">c.NotebookApp.port = 8080</span>
        <span class="no">c.NotebookApp.ip = &#39;0.0.0.0&#39;</span>
        <span class="no">c.NotebookApp.disable_check_xsrf = True</span>
        <span class="no">c.NotebookApp.allow_origin = &#39;*&#39;</span>
        <span class="no">c.Application.log_level = &#39;DEBUG&#39;</span>
      <span class="l l-Scalar l-Scalar-Plain">mount_path</span><span class="p p-Indicator">:</span> <span class="s">&#39;/ood&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="mounts">
<span id="kubernetes-mounts"></span><h2>mounts<a class="headerlink" href="#mounts" title="Permalink to this headline">¶</a></h2>
<p>This example mounts the host’s directory into the container.
Even though these are containers, users often want to persist
the files they work on.  This example mounts the home directory,
but could mount any project or scratch space just the same.</p>
<p>When mounting a host directory <code class="docutils literal notranslate"><span class="pre">host_type</span></code> must alwasy be Directory.
This example shows how to mount host directories and nfs storage locations.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">mounts</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">host</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">home</span>
    <span class="l l-Scalar l-Scalar-Plain">host_type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Directory</span>
    <span class="l l-Scalar l-Scalar-Plain">path</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;%= user.home %&gt;</span>
    <span class="l l-Scalar l-Scalar-Plain">destination_path</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;%= user.home %&gt;</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nfs</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cold-storage</span>
    <span class="l l-Scalar l-Scalar-Plain">server</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">some.nfs.host:3333</span>
    <span class="l l-Scalar l-Scalar-Plain">path</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/some/location</span>
    <span class="l l-Scalar l-Scalar-Plain">destination_path</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/some/container/location</span>
</pre></div>
</div>
</div>
<div class="section" id="init-containers">
<h2>init containers<a class="headerlink" href="#init-containers" title="Permalink to this headline">¶</a></h2>
<p>If you’re app needs some work to be done before the app itself
(the container) starts up, we provide a way to specify init containers.</p>
<p>We provide <code class="docutils literal notranslate"><span class="pre">docker.io/ohiosupercomputer/ood-k8s-utils</span></code> for some simple
reusable functionality.</p>
<p>You must specify a <code class="docutils literal notranslate"><span class="pre">name</span></code>, an <code class="docutils literal notranslate"><span class="pre">image</span></code> and the <code class="docutils literal notranslate"><span class="pre">command</span></code> to be run.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">init_containers</span><span class="p p-Indicator">:</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;init-secret&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="s">&quot;&lt;%=</span><span class="nv"> </span><span class="s">utility_img</span><span class="nv"> </span><span class="s">%&gt;&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">command</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="s">&quot;/bin/save_passwd_as_secret&quot;</span>
  <span class="p p-Indicator">-</span> <span class="s">&quot;user-&lt;%=</span><span class="nv"> </span><span class="s">user.name</span><span class="nv"> </span><span class="s">%&gt;&quot;</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">If you’re mounting a users <code class="docutils literal notranslate"><span class="pre">$HOME</span></code> directory into the container, you
likely don’t need init containers.  They’re provided for sites &amp; use cases
where you’re not mounting the users <code class="docutils literal notranslate"><span class="pre">$HOME</span></code> directory.  This example
does both because it is just an example.</p>
</div>
<p>Let’s walk through these init containers and what they’re doing.</p>
<p><code class="docutils literal notranslate"><span class="pre">init-secret</span></code> does just that. It initialzies a <a class="reference external" href="https://kubernetes.io/docs/concepts/configuration/secret/">kubernetes secret</a>.
<code class="docutils literal notranslate"><span class="pre">add-passwd-to-cfg</span></code> then reads that secret and creates a salt and
sha1 of this secret (these are needed specifically for Jupyter).  Lastly
it adds a single line to our configmap, which is the <code class="docutils literal notranslate"><span class="pre">c.NotebookApp.password</span></code>.
<code class="docutils literal notranslate"><span class="pre">add-hostport-to-cfg</span></code> does something similar, reading the host and port
of the pod and sets the <code class="docutils literal notranslate"><span class="pre">c.NotebookApp.base_url</span></code> of the same configmap.</p>
</div>
<div class="section" id="submit-yml-in-full">
<h2>submit yml in full<a class="headerlink" href="#submit-yml-in-full" title="Permalink to this headline">¶</a></h2>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># submit.yml.erb</span>
<span class="l l-Scalar l-Scalar-Plain">&lt;%</span>
 <span class="l l-Scalar l-Scalar-Plain">pwd_cfg = &quot;c.NotebookApp.password=u\&#39;sha1:${SALT}:${PASSWORD_SHA1}\&#39;&quot;</span>
 <span class="l l-Scalar l-Scalar-Plain">host_port_cfg = &quot;c.NotebookApp.base_url=\&#39;/node/${HOST_CFG}/${PORT_CFG}/\&#39;&quot;</span>

 <span class="l l-Scalar l-Scalar-Plain">configmap_filename = &quot;ondemand_config.py&quot;</span>
 <span class="l l-Scalar l-Scalar-Plain">configmap_data = &quot;c.NotebookApp.port = 8080&quot;</span>
 <span class="l l-Scalar l-Scalar-Plain">utility_img = &quot;docker.io/ohiosupercomputer/ood-k8s-utils:v1.0.0&quot;</span>

 <span class="l l-Scalar l-Scalar-Plain">user = OodSupport::User.new</span>
<span class="l l-Scalar l-Scalar-Plain">%&gt;</span>
<span class="nn">---</span>
<span class="l l-Scalar l-Scalar-Plain">script</span><span class="p p-Indicator">:</span>
<span class="l l-Scalar l-Scalar-Plain">accounting_id</span><span class="p p-Indicator">:</span> <span class="s">&quot;&lt;%=</span><span class="nv"> </span><span class="s">account</span><span class="nv"> </span><span class="s">%&gt;&quot;</span>
<span class="l l-Scalar l-Scalar-Plain">wall_time</span><span class="p p-Indicator">:</span> <span class="s">&quot;&lt;%=</span><span class="nv"> </span><span class="s">wall_time.to_i</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">3600</span><span class="nv"> </span><span class="s">%&gt;&quot;</span>
<span class="l l-Scalar l-Scalar-Plain">native</span><span class="p p-Indicator">:</span>

  <span class="c1"># here&#39;s the bulk of setting up the container. You&#39;ll likely need to specify all of these.</span>
  <span class="l l-Scalar l-Scalar-Plain">container</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;jupyter&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="s">&quot;docker-registry.osc.edu/ondemand/scipy-notebook:python-3.9.2&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">command</span><span class="p p-Indicator">:</span> <span class="s">&quot;/usr/local/bin/start.sh</span><span class="nv"> </span><span class="s">/opt/conda/bin/jupyter</span><span class="nv"> </span><span class="s">notebook</span><span class="nv"> </span><span class="s">--config=/ood/ondemand_config.py&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">working_dir</span><span class="p p-Indicator">:</span> <span class="s">&quot;&lt;%=</span><span class="nv"> </span><span class="s">Etc.getpwnam(ENV[&#39;USER&#39;]).dir</span><span class="nv"> </span><span class="s">%&gt;&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">restart_policy</span><span class="p p-Indicator">:</span> <span class="s">&#39;OnFailure&#39;</span>
    <span class="l l-Scalar l-Scalar-Plain">env</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">NB_UID</span><span class="p p-Indicator">:</span> <span class="s">&quot;&lt;%=</span><span class="nv"> </span><span class="s">user.uid</span><span class="nv"> </span><span class="s">%&gt;&quot;</span>
      <span class="l l-Scalar l-Scalar-Plain">NB_USER</span><span class="p p-Indicator">:</span> <span class="s">&quot;&lt;%=</span><span class="nv"> </span><span class="s">user.name</span><span class="nv"> </span><span class="s">%&gt;&quot;</span>
      <span class="l l-Scalar l-Scalar-Plain">NB_GID</span><span class="p p-Indicator">:</span> <span class="s">&quot;&lt;%=</span><span class="nv"> </span><span class="s">user.group.id</span><span class="nv"> </span><span class="s">%&gt;&quot;</span>
      <span class="l l-Scalar l-Scalar-Plain">HOME</span><span class="p p-Indicator">:</span> <span class="s">&quot;&lt;%=</span><span class="nv"> </span><span class="s">user.home</span><span class="nv"> </span><span class="s">%&gt;&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="s">&quot;8080&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">cpu</span><span class="p p-Indicator">:</span> <span class="s">&quot;&lt;%=</span><span class="nv"> </span><span class="s">cpu</span><span class="nv"> </span><span class="s">%&gt;&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">memory</span><span class="p p-Indicator">:</span> <span class="s">&quot;&lt;%=</span><span class="nv"> </span><span class="s">memory</span><span class="nv"> </span><span class="s">%&gt;Gi&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">configmap</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">files</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">filename</span><span class="p p-Indicator">:</span> <span class="s">&quot;&lt;%=</span><span class="nv"> </span><span class="s">configmap_filename</span><span class="nv"> </span><span class="s">%&gt;&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">data</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
          <span class="no">c.NotebookApp.port = 8080</span>
          <span class="no">c.NotebookApp.ip = &#39;0.0.0.0&#39;</span>
          <span class="no">c.NotebookApp.disable_check_xsrf = True</span>
          <span class="no">c.NotebookApp.allow_origin = &#39;*&#39;</span>
          <span class="no">c.Application.log_level = &#39;DEBUG&#39;</span>
        <span class="l l-Scalar l-Scalar-Plain">mount_path</span><span class="p p-Indicator">:</span> <span class="s">&#39;/ood&#39;</span>
  <span class="l l-Scalar l-Scalar-Plain">mounts</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">host</span>
      <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">home</span>
      <span class="l l-Scalar l-Scalar-Plain">host_type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Directory</span>
      <span class="l l-Scalar l-Scalar-Plain">path</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;%= user.home %&gt;</span>
      <span class="l l-Scalar l-Scalar-Plain">destination_path</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;%= user.home %&gt;</span>
  <span class="l l-Scalar l-Scalar-Plain">init_containers</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;init-secret&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="s">&quot;&lt;%=</span><span class="nv"> </span><span class="s">utility_img</span><span class="nv"> </span><span class="s">%&gt;&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">command</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;/bin/save_passwd_as_secret&quot;</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;user-&lt;%=</span><span class="nv"> </span><span class="s">user.name</span><span class="nv"> </span><span class="s">%&gt;&quot;</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;add-passwd-to-cfg&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="s">&quot;&lt;%=</span><span class="nv"> </span><span class="s">utility_img</span><span class="nv"> </span><span class="s">%&gt;&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">command</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;/bin/bash&quot;</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;-c&quot;</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;source</span><span class="nv"> </span><span class="s">/bin/passwd_from_secret;</span><span class="nv"> </span><span class="s">source</span><span class="nv"> </span><span class="s">/bin/create_salt_and_sha1;</span><span class="nv"> </span><span class="s">/bin/add_line_to_configmap</span><span class="nv"> </span><span class="s">\\\&quot;&lt;%=</span><span class="nv"> </span><span class="s">pwd_cfg</span><span class="nv"> </span><span class="s">%&gt;\\\&quot;</span><span class="nv"> </span><span class="s">&lt;%=</span><span class="nv"> </span><span class="s">configmap_filename</span><span class="nv"> </span><span class="s">%&gt;&quot;</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;add-hostport-to-cfg&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="s">&quot;&lt;%=</span><span class="nv"> </span><span class="s">utility_img</span><span class="nv"> </span><span class="s">%&gt;&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">command</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;/bin/bash&quot;</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;-c&quot;</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;source</span><span class="nv"> </span><span class="s">/bin/find_host_port;</span><span class="nv"> </span><span class="s">/bin/add_line_to_configmap</span><span class="nv"> </span><span class="s">\\\&quot;&lt;%=</span><span class="nv"> </span><span class="s">host_port_cfg</span><span class="nv"> </span><span class="s">%&gt;\\\&quot;</span><span class="nv"> </span><span class="s">&lt;%=</span><span class="nv"> </span><span class="s">configmap_filename</span><span class="nv"> </span><span class="s">%&gt;&quot;</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="k8s-like-hpc-jupyter.html" class="btn btn-neutral float-right" title="Add a Jupyter App on a Kubernetes Cluster that behaves like HPC compute" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="add-matlab/known-issues.html" class="btn btn-neutral float-left" title="8. Known Issues" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017-2021, Ohio Supercomputer Center

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Documentation Versions</span>
    v: 
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Versions</dt>
      
        <dd><a href="https://OSC.github.io/ood-documentation/latest/app-development/tutorials-interactive-apps/k8s-jupyter.html">latest</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-2.0/app-development/tutorials-interactive-apps/k8s-jupyter.html">2.0</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.8/app-development/tutorials-interactive-apps/k8s-jupyter.html">1.8</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.7/app-development/tutorials-interactive-apps/k8s-jupyter.html">1.7</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.6/app-development/tutorials-interactive-apps/k8s-jupyter.html">1.6</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.5/app-development/tutorials-interactive-apps/k8s-jupyter.html">1.5</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.4/app-development/tutorials-interactive-apps/k8s-jupyter.html">1.4</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.3/app-development/tutorials-interactive-apps/k8s-jupyter.html">1.3</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.2/app-development/tutorials-interactive-apps/k8s-jupyter.html">1.2</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.1/app-development/tutorials-interactive-apps/k8s-jupyter.html">1.1</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.0/app-development/tutorials-interactive-apps/k8s-jupyter.html">1.0</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/develop/app-development/tutorials-interactive-apps/k8s-jupyter.html">develop</a></dd>
      
    </dl>
    <dl>
      <dt>On GitHub</dt>
        <dd>
          <a href="http://openondemand.org/">Website</a>
        </dd>
        <dd>
          <a href="https://github.com/OSC/Open-OnDemand">Main Repo</a>
        </dd>
    </dl>
    <hr/>
    Theme provided by <a href="http://www.readthedocs.org">Read the Docs</a>.
  </div>
</div>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>