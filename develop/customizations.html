

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Customizations &mdash; Open OnDemand 2.1.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="_static/tabs.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Debugging and Monitoring" href="how-tos/debug.html" />
    <link rel="prev" title="3. Enable Reverse Proxy" href="how-tos/app-development/interactive/setup/enable-reverse-proxy.html" />
 
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-34776817-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-34776817-3');
</script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html">
          

          
            
            <img src="_static/logo.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                2.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="requirements.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="authentication.html">Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation/add-cluster-config.html">Cluster Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="how-tos/app-development/interactive/setup.html">Setup Interactive Apps</a></li>
</ul>
<p class="caption"><span class="caption-text">How-Tos</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Customizations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#announcements">Announcements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#message-of-the-day-motd">Message of the Day (MOTD)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#branding">Branding</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#custom-css-files">Custom CSS files</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#add-urls-to-help-menu">Add URLs to Help Menu</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-shortcuts-to-files-menu">Add Shortcuts to Files Menu</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuration-profiles">Configuration Profiles</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#manual-profile-selection">Manual Profile Selection</a></li>
<li class="toctree-l3"><a class="reference internal" href="#automatic-profile-selection">Automatic Profile Selection</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#changing-the-navigation-bar">Changing the Navigation bar</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#understanding-the-default-navigation-bar">Understanding the default navigation bar</a></li>
<li class="toctree-l3"><a class="reference internal" href="#limit-auto-generated-menu-bars">Limit auto generated menu bars</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-manifests-to-create-menu-items">Using manifests to create menu items</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fully-customizing-the-navigation-bar">Fully customizing the navigation bar</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#menus-by-application-category">Menus by Application category</a></li>
<li class="toctree-l4"><a class="reference internal" href="#predefined-templates">Predefined templates</a></li>
<li class="toctree-l4"><a class="reference internal" href="#menus-based-on-applications">Menus based on applications</a></li>
<li class="toctree-l4"><a class="reference internal" href="#menus-based-on-links">Menus based on links</a></li>
<li class="toctree-l4"><a class="reference internal" href="#menus-for-profile-links">Menus for profile links</a></li>
<li class="toctree-l4"><a class="reference internal" href="#menus-for-custom-pages">Menus for custom pages</a></li>
<li class="toctree-l4"><a class="reference internal" href="#menus-for-urls">Menus for URLs</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#interactive-apps-menu">Interactive Apps Menu</a></li>
<li class="toctree-l2"><a class="reference internal" href="#set-upload-limits">Set Upload Limits</a></li>
<li class="toctree-l2"><a class="reference internal" href="#block-or-allow-directory-access">Block or Allow Directory Access</a></li>
<li class="toctree-l2"><a class="reference internal" href="#set-default-ssh-host">Set Default SSH Host</a></li>
<li class="toctree-l2"><a class="reference internal" href="#set-ssh-allowlist">Set SSH Allowlist</a></li>
<li class="toctree-l2"><a class="reference internal" href="#shell-app-ssh-command-wrapper">Shell App SSH Command Wrapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fix-unauthorized-websocket-connection-in-shell-app">Fix Unauthorized WebSocket Connection in Shell App</a></li>
<li class="toctree-l2"><a class="reference internal" href="#custom-job-composer-templates">Custom Job Composer Templates</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#job-templates-overview">Job Templates Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#job-template-details">Job Template Details</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#job-composer-script-size-limit">Job Composer Script Size Limit</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hiding-job-arrays">Hiding Job Arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="#custom-error-page-for-missing-home-directory-on-launch">Custom Error Page for Missing Home Directory on Launch</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pinning-applications-to-the-dashboard">Pinning Applications to the Dashboard</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#pinned-apps-customizations">Pinned Apps customizations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#custom-layouts-in-the-dashboard">Custom layouts in the dashboard</a></li>
<li class="toctree-l2"><a class="reference internal" href="#customize-text-in-ondemand">Customize Text in OnDemand</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#change-the-dashboard-tagline">Change the Dashboard Tagline</a></li>
<li class="toctree-l3"><a class="reference internal" href="#change-quota-messages-in-the-dashboard">Change quota messages in the Dashboard</a></li>
<li class="toctree-l3"><a class="reference internal" href="#customize-text-in-the-job-composer-s-options-form">Customize Text in the Job Composer’s options form</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#disk-quota-warnings-on-dashboard">Disk Quota Warnings on Dashboard</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#individual-user-quota">Individual User Quota</a></li>
<li class="toctree-l3"><a class="reference internal" href="#individual-fileset-quota">Individual Fileset Quota</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#balance-warnings-on-dashboard">Balance Warnings on Dashboard</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#user-balance">User Balance</a></li>
<li class="toctree-l3"><a class="reference internal" href="#project-balance">Project Balance</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#maintenance-mode">Maintenance Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="#grafana-support">Grafana support</a></li>
<li class="toctree-l2"><a class="reference internal" href="#disable-host-link-in-batch-connect-session-card">Disable Host Link in Batch Connect Session Card</a></li>
<li class="toctree-l2"><a class="reference internal" href="#set-illegal-job-name-characters">Set Illegal Job Name Characters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#customize-dex-theme">Customize Dex Theme</a></li>
<li class="toctree-l2"><a class="reference internal" href="#xdmod-integration">XDMoD Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#accessing-remote-file-systems">Accessing Remote File Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cancel-interactive-sessions">Cancel Interactive Sessions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#custom-pages">Custom Pages</a></li>
<li class="toctree-l2"><a class="reference internal" href="#support-tickets">Support Tickets</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id21">Customizations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="how-tos/debug.html">Debugging and Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="enable-desktops.html">Enable Interactive Desktop</a></li>
<li class="toctree-l1"><a class="reference internal" href="how-tos/app-development.html">App Development</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="install-ihpc-apps.html">Install Other Interactive Apps</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/tutorials-interactive-apps.html">Tutorials: Interactive Apps</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/tutorials-passenger-apps.html">Tutorials: Passenger Apps</a></li>
</ul>
<p class="caption"><span class="caption-text">More</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Configuration Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="release-notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="issues/overview.html">OnDemand’s Known Issues</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Open OnDemand</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Customizations</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/OSC/ood-documentation/blob/develop/source/customizations.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="customizations">
<span id="id1"></span><h1>Customizations<a class="headerlink" href="#customizations" title="Permalink to this headline">¶</a></h1>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Check out the <a class="reference internal" href="reference/pun-environment.html#pun-environment"><span class="std std-ref">PUN environment</span></a> for an overview of how environment variables can be
added.</p>
</div>
<div class="section" id="announcements">
<h2>Announcements<a class="headerlink" href="#announcements" title="Permalink to this headline">¶</a></h2>
<p>To add an announcement message that appears at the top of the dashboard you can create a file at <code class="docutils literal notranslate"><span class="pre">/etc/ood/config/announcement.(md|yml)</span></code> or <code class="docutils literal notranslate"><span class="pre">/etc/ood/config/announcements.d/any_file_name.(md|yml)</span></code>.</p>
<p>On each request the dashboard will check for the existence of this file. If it exists, the contents will be converted using markdown converter to HTML and displayed inside a bootstrap alert.</p>
<p>For example, if I create an announcement.md file with the contents:</p>
<blockquote>
<div><div class="highlight-md notranslate"><div class="highlight"><pre><span></span><span class="gs">**NOTICE:**</span> There will be a two day downtime on February 21-22, 2017. OSC
OnDemand will be unavailable during this period. For details, please visit
[<span class="nt">http://bit.ly/2jhfyh7</span>](<span class="na">http://bit.ly/2jhfyh7</span>).
</pre></div>
</div>
</div></blockquote>
<p>the user would see this message at the top of the dashboard:</p>
<div class="figure align-center" id="id22">
<img alt="_images/dashboard-announcement.png" src="_images/dashboard-announcement.png" />
<p class="caption"><span class="caption-number">Fig. 1 </span><span class="caption-text">Example of the Dashboard announcement.</span><a class="headerlink" href="#id22" title="Permalink to this image">¶</a></p>
</div>
<p>If the announcement file has the extension <code class="docutils literal notranslate"><span class="pre">yml</span></code> and is a yaml file it is first rendered using ERB and then the resulting file is parsed as YAML. The valid keys are:</p>
<table class="docutils align-default" id="id23">
<caption><span class="caption-number">Table 1 </span><span class="caption-text">Config Files</span><a class="headerlink" href="#id23" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<tbody>
<tr class="row-odd"><th class="stub"><p>type</p></th>
<td><p>warning, info, success, or danger</p></td>
<td><p>this is the Bootstrap alert style</p></td>
</tr>
<tr class="row-even"><th class="stub"><p>msg</p></th>
<td><p>string containing markdown formatted message</p></td>
<td><p>if this is a blank string (only whitespace), the alert will not display</p></td>
</tr>
</tbody>
</table>
<p>Because the announcement is rendered via ERB you can do some interesting things, like stop showing the announcement past a specified date:</p>
<blockquote>
<div><div class="highlight-erb notranslate"><div class="highlight"><pre><span></span><span class="x">type: warning</span>
<span class="x">msg: |</span>
<span class="x">  </span><span class="cp">&lt;%</span> <span class="k">if</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span> <span class="o">&lt;</span> <span class="no">Time</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  A **Ruby Partial Downtime** for 4 hours on Monday, September 24 from 8:00am to 12:00pm</span>
<span class="x">  will prevent SSH login to Ruby nodes and and Ruby VDI sessions.</span>
<span class="x">  </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Warnings about the announcement file being missing may be present in users’ nginx logs. Despite the warning the Dashboard will still function normally without those files being present.</p>
</div>
</div>
<div class="section" id="message-of-the-day-motd">
<span id="motd-customization"></span><h2>Message of the Day (MOTD)<a class="headerlink" href="#message-of-the-day-motd" title="Permalink to this headline">¶</a></h2>
<p>You can configure the Dashboard to display the /etc/motd file on the front page - the same file that is displayed when ssh-ing to a login node.</p>
<p>To display a MOTD file on the Dashboard ensure that the environment variables <code class="docutils literal notranslate"><span class="pre">$MOTD_PATH</span></code> and <code class="docutils literal notranslate"><span class="pre">$MOTD_FORMAT</span></code> are set, where</p>
<blockquote>
<div><div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">MOTD_PATH</span><span class="o">=</span><span class="s2">&quot;/etc/motd&quot;</span> <span class="c1"># this supports both file and RSS feed URIs</span>
<span class="nv">MOTD_FORMAT</span><span class="o">=</span><span class="s2">&quot;txt&quot;</span> <span class="c1"># markdown, txt, rss, markdown_erb, txt_erb</span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The <code class="docutils literal notranslate"><span class="pre">_erb</span></code> formats support ERB rendering to generate more dynamic messages.</p>
</div>
<div class="figure align-center" id="id24">
<img alt="_images/dashboard_motd.png" src="_images/dashboard_motd.png" />
<p class="caption"><span class="caption-number">Fig. 2 </span><span class="caption-text">Message of the Day appears in the body of the index page.</span><a class="headerlink" href="#id24" title="Permalink to this image">¶</a></p>
</div>
<p>We recommend setting this in <code class="docutils literal notranslate"><span class="pre">/etc/ood/config/apps/dashboard/env</span></code>.</p>
</div>
<div class="section" id="branding">
<h2>Branding<a class="headerlink" href="#branding" title="Permalink to this headline">¶</a></h2>
<p id="id2">You can customize the logo, favicon, title, and navbar colors of OnDemand.</p>
<div class="figure align-center">
<img alt="_images/dashboard_branding_logo_and_colors.png" src="_images/dashboard_branding_logo_and_colors.png" />
</div>
<p>We recommend setting these values using the <a class="reference internal" href="reference/files/ondemand-d-ymls.html#ondemand-d-ymls"><span class="std std-ref">OnDemand configuration properties</span></a>.
Currently only the dashboard uses the colors in the navbar.</p>
<table class="docutils align-default" id="id25">
<caption><span class="caption-number">Table 2 </span><span class="caption-text">Branding</span><a class="headerlink" href="#id25" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head stub"><p>Feature</p></th>
<th class="head"><p>Property</p></th>
<th class="head"><p>Details</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><th class="stub"><p>Title</p></th>
<td><p>dashboard_title</p></td>
<td><p>The title appears in the navbar and is controlled by the property <code class="docutils literal notranslate"><span class="pre">dashboard_title</span></code>. The default value is “Open OnDemand”.</p></td>
</tr>
<tr class="row-odd"><th class="stub"><p>Logo</p></th>
<td><p>dashboard_logo</p></td>
<td><p>The default value for <code class="docutils literal notranslate"><span class="pre">dashboard_logo</span></code> is <code class="docutils literal notranslate"><span class="pre">/public/logo.png</span></code> and this should be the URL to the logo. By default if you place a logo.png at <code class="docutils literal notranslate"><span class="pre">/var/www/ood/public/logo.png</span></code> it will be accessible via the URL <code class="docutils literal notranslate"><span class="pre">https://your.ondemand.institution.edu/public/logo.png</span></code>.  SVG logo format is also supported.</p></td>
</tr>
<tr class="row-even"><th class="stub"><p>Logo height</p></th>
<td><p>dashboard_logo_height</p></td>
<td><p>The CSS height of the dashboard logo.</p></td>
</tr>
<tr class="row-odd"><th class="stub"><p>Favicon</p></th>
<td><p>public_url</p></td>
<td><p>The favicon is expected to exist at the path <code class="docutils literal notranslate"><span class="pre">$public_url/favicon.ico</span></code>. For a default OOD installation the favicon will be located at <code class="docutils literal notranslate"><span class="pre">/var/www/ood/public/favicon.ico</span></code>.</p></td>
</tr>
<tr class="row-even"><th class="stub"><p>Brand background color</p></th>
<td><p>brand_bg_color</p></td>
<td><p>Controls the background color of the navbar in the dashboard</p></td>
</tr>
<tr class="row-odd"><th class="stub"><p>Brand foreground color</p></th>
<td><p>brand_link_active_bg_color</p></td>
<td><p>Controls the background color the active link in the navbar in the dashboard</p></td>
</tr>
<tr class="row-even"><th class="stub"><p>Replace header title with logo</p></th>
<td><p>dashboard_header_img_logo</p></td>
<td><p>Value should be url to logo i.e. <code class="docutils literal notranslate"><span class="pre">/public/logo.png</span></code>.  the background color the active link in the navbar in the dashboard</p></td>
</tr>
<tr class="row-odd"><th class="stub"><p>Use white text on black background for navbar.</p></th>
<td><p>navbar_type</p></td>
<td><p>By default we use <code class="docutils literal notranslate"><span class="pre">inverse</span></code> for this value, which specifies to use <a class="reference external" href="https://getbootstrap.com/docs/3.3/components/#navbar-inverted">Bootstrap 3’s inverted navbar</a> where text is white and background is black (or dark grey). You can set this to <code class="docutils literal notranslate"><span class="pre">default</span></code> to use black text on light grey background if it fits your branding better.</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is possible to configure these settings using environment variables, although this is deprecated.
For information about the properties and environment variables, see the <a class="reference internal" href="reference/files/ondemand-d-ymls.html#ondemand-d-ymls"><span class="std std-ref">OnDemand configuration documentation</span></a>.</p>
</div>
<div class="figure align-center" id="id26">
<img alt="_images/dashboard_navbar_branding_bluered.png" src="_images/dashboard_navbar_branding_bluered.png" />
<p class="caption"><span class="caption-number">Fig. 3 </span><span class="caption-text">Nav bar if I set <code class="docutils literal notranslate"><span class="pre">brand_bg_color</span></code> to <code class="docutils literal notranslate"><span class="pre">#0000ff</span></code> and <code class="docutils literal notranslate"><span class="pre">brand_link_active_bg_color</span></code> to <code class="docutils literal notranslate"><span class="pre">#ff0000</span></code> and <code class="docutils literal notranslate"><span class="pre">dashboard_title</span></code> to <code class="docutils literal notranslate"><span class="pre">OSC</span> <span class="pre">OnDemand</span></code></span><a class="headerlink" href="#id26" title="Permalink to this image">¶</a></p>
</div>
<div class="section" id="custom-css-files">
<h3>Custom CSS files<a class="headerlink" href="#custom-css-files" title="Permalink to this headline">¶</a></h3>
<p>For more control on the look and feel of the dashboard pages, use custom CSS files.
These CSS files will be added to all dashboard pages and loaded last to have precedence over default styles.</p>
<p>Add your CSS file references to the <code class="docutils literal notranslate"><span class="pre">custom_css_files</span></code> array property.
Drop the files into the Apache public assets folder, the default location is: <code class="docutils literal notranslate"><span class="pre">/var/www/ood/public</span></code>.
The system will prepend the <code class="docutils literal notranslate"><span class="pre">/public</span></code> URL path, based on the <code class="docutils literal notranslate"><span class="pre">public_url</span></code> property, to load the files correctly.</p>
<p><strong>Example:</strong> to load the following CSS file: <code class="docutils literal notranslate"><span class="pre">/var/www/ood/public/myfolder/custom-branding.css</span></code>, add the configuration below.
This will result in a CSS tag added to all dashboard pages with the path: <code class="docutils literal notranslate"><span class="pre">/public/myfolder/custom-branding.css</span></code>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">custom_css_files</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;/myfolder/custom-branding.css&quot;</span><span class="p p-Indicator">]</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="add-urls-to-help-menu">
<span id="help-menu-guide"></span><h2>Add URLs to Help Menu<a class="headerlink" href="#add-urls-to-help-menu" title="Permalink to this headline">¶</a></h2>
<p>These URLs can be specified, which will appear in the Help menu and on other locations of the Dashboard. We recommend setting this in <code class="docutils literal notranslate"><span class="pre">/etc/ood/config/apps/dashboard/env</span></code>.</p>
<table class="docutils align-default" id="id27">
<caption><span class="caption-number">Table 3 </span><span class="caption-text">Dashboard URLs</span><a class="headerlink" href="#id27" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head stub"><p>Name</p></th>
<th class="head"><p>Environment variable</p></th>
<th class="head"><p>Example value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><th class="stub"><p>Support URL</p></th>
<td><p>OOD_DASHBOARD_SUPPORT_URL</p></td>
<td><p><a class="reference external" href="https://www.osc.edu/contact/supercomputing_support">https://www.osc.edu/contact/supercomputing_support</a></p></td>
</tr>
<tr class="row-odd"><th class="stub"><p>Support Email</p></th>
<td><p>OOD_DASHBOARD_SUPPORT_EMAIL</p></td>
<td><p><a class="reference external" href="mailto:oschelp&#37;&#52;&#48;osc&#46;edu">oschelp<span>&#64;</span>osc<span>&#46;</span>edu</a></p></td>
</tr>
<tr class="row-even"><th class="stub"><p>User Documentation</p></th>
<td><p>OOD_DASHBOARD_DOCS_URL</p></td>
<td><p><a class="reference external" href="https://www.osc.edu/ondemand">https://www.osc.edu/ondemand</a></p></td>
</tr>
<tr class="row-odd"><th class="stub"><p>Developer Documentation</p></th>
<td><p>OOD_DASHBOARD_DEV_DOCS_URL</p></td>
<td><p><a class="reference external" href="https://osc.github.io/ood-documentation/master/app-development.html">https://osc.github.io/ood-documentation/master/app-development.html</a> (link appears in Develop dropdown if developer mode enabled for user)</p></td>
</tr>
<tr class="row-even"><th class="stub"><p>Change Password URL</p></th>
<td><p>OOD_DASHBOARD_PASSWD_URL</p></td>
<td><p><a class="reference external" href="https://my.osc.edu">https://my.osc.edu</a></p></td>
</tr>
<tr class="row-odd"><th class="stub"><p>Custom Help URL (Also requires locale <code class="docutils literal notranslate"><span class="pre">en.dashboard.nav_help_custom</span></code>)</p></th>
<td><p>OOD_DASHBOARD_HELP_CUSTOM_URL</p></td>
<td><p><a class="reference external" href="https://idp.osc.edu/auth/realms/osc/account/identity">https://idp.osc.edu/auth/realms/osc/account/identity</a></p></td>
</tr>
</tbody>
</table>
<p>Since OnDemand 2.1, custom links can be added to the Help menu using the configuration property <code class="docutils literal notranslate"><span class="pre">help_menu</span></code>.
Links will be inserted at the end of the core links already included in the menu by the OnDemand codebase.</p>
<p><code class="docutils literal notranslate"><span class="pre">help_menu</span></code> supports all the link definitions developed for the custom navigation configuration.
For more information on how to create custom links, see for example <a class="reference internal" href="#menus-for-urls"><span class="std std-ref">adding urls to menus</span></a>.</p>
<p>For information about how to configure properties, see the <a class="reference internal" href="reference/files/ondemand-d-ymls.html#ondemand-d-ymls"><span class="std std-ref">OnDemand configuration documentation</span></a>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">help_menu</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Documentation&quot;</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Jupyter</span><span class="nv"> </span><span class="s">Docs&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">icon</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;fas://book&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://mydomain.com/path/jupyter&quot;</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Support</span><span class="nv"> </span><span class="s">Docs&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">icon</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;fas://book&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://mydomain.com/path/support/docs&quot;</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Custom</span><span class="nv"> </span><span class="s">Pages&quot;</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">page</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;rstudio_guide&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;RStudio</span><span class="nv"> </span><span class="s">Guide&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">icon</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;fas://window-restore&quot;</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Profiles&quot;</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">profile</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;team1&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Team</span><span class="nv"> </span><span class="s">1&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">icon</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;fas://user&quot;</span><span class="w"></span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="_images/help_menu_links.png" src="_images/help_menu_links.png" />
</div>
</div>
<div class="section" id="add-shortcuts-to-files-menu">
<span id="id3"></span><h2>Add Shortcuts to Files Menu<a class="headerlink" href="#add-shortcuts-to-files-menu" title="Permalink to this headline">¶</a></h2>
<p>The Files menu by default has a single link to open the Files app in the user’s
Home Directory. More links can be added to this menu, for Scratch space and
Project space directories.</p>
<p>Adding more links currently requires adding a custom initializer to the
Dashboard app. Ruby code is placed in the initializer to add one or more Ruby
<code class="docutils literal notranslate"><span class="pre">FavoritePath</span></code> (or <code class="docutils literal notranslate"><span class="pre">Pathname</span></code> for backwards compatibility)  objects to the <code class="docutils literal notranslate"><span class="pre">OodFilesApp.candidate_favorite_paths</span></code> array, a
global attribute that is used in the Dashboard app.</p>
<p><code class="docutils literal notranslate"><span class="pre">FavoritePath</span></code> is instantiated with a single <code class="docutils literal notranslate"><span class="pre">String</span></code> or <code class="docutils literal notranslate"><span class="pre">Pathname</span></code> argument, the
directory path, and with an optional keyword argument <code class="docutils literal notranslate"><span class="pre">title</span></code> specifying a
human readable title for that path.</p>
<p>Start by creating the file
<code class="file docutils literal notranslate"><span class="pre">/etc/ood/config/apps/dashboard/initializers/ood.rb</span></code> as such:</p>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="c1"># /etc/ood/config/apps/dashboard/initializers/ood.rb</span>

<span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">after_initialize</span> <span class="k">do</span>
  <span class="no">OodFilesApp</span><span class="o">.</span><span class="n">candidate_favorite_paths</span><span class="o">.</span><span class="n">tap</span> <span class="k">do</span> <span class="o">|</span><span class="n">paths</span><span class="o">|</span>
    <span class="c1"># add project space directories</span>
    <span class="n">projects</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:name</span><span class="p">)</span><span class="o">.</span><span class="n">grep</span><span class="p">(</span><span class="sr">/^P./</span><span class="p">)</span>
    <span class="n">paths</span><span class="o">.</span><span class="n">concat</span> <span class="n">projects</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="nb">p</span><span class="o">|</span> <span class="no">FavoritePath</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;/fs/project/</span><span class="si">#{</span><span class="nb">p</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="p">}</span>

    <span class="c1"># add User scratch space directory</span>
    <span class="n">paths</span> <span class="o">&lt;&lt;</span> <span class="no">FavoritePath</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;/fs/scratch/</span><span class="si">#{</span><span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Project scratch is given an optional title field</span>
    <span class="n">paths</span><span class="o">.</span><span class="n">concat</span> <span class="n">projects</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="nb">p</span><span class="o">|</span> <span class="no">FavoritePath</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;/fs/scratch/</span><span class="si">#{</span><span class="nb">p</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="ss">title</span><span class="p">:</span> <span class="s2">&quot;Scratch&quot;</span><span class="p">)</span>  <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The variable <code class="docutils literal notranslate"><span class="pre">paths</span></code> is an array of <code class="docutils literal notranslate"><span class="pre">FavoritePath</span></code> objects that define a list
of what will appear in the Dashboard menu for Files</p></li>
<li><p>At OSC, the pattern for project paths follows
<code class="file docutils literal notranslate"><span class="pre">/fs/project/</span><em><span class="pre">project_name</span></em></code>. So above we:</p>
<ol class="arabic simple">
<li><p>get an array of all user’s groups by name</p></li>
<li><p>filter that array for groups that start with <code class="docutils literal notranslate"><span class="pre">P</span></code> (i.e., <code class="docutils literal notranslate"><span class="pre">PZS0002</span></code>,
<code class="docutils literal notranslate"><span class="pre">PAW0003</span></code>, …)</p></li>
<li><p>using <code class="docutils literal notranslate"><span class="pre">map</span></code> we turn this array into an array of <code class="docutils literal notranslate"><span class="pre">FavoritePath</span></code> objects to
all the possible project directories the user could have.</p></li>
<li><p>extend the paths array with this list of paths</p></li>
</ol>
</li>
<li><p>For possible scratch space directories, we look for either
<code class="file docutils literal notranslate"><span class="pre">/fs/scratch/</span><em><span class="pre">project_name</span></em></code> or <code class="file docutils literal notranslate"><span class="pre">/fs/scratch/</span><em><span class="pre">user_name</span></em></code></p></li>
<li><p>Additionally project scratch directories have a ‘title’ attribute and will
with in the dropdown with both the title and the path.</p></li>
</ul>
<p>On each request, the Dashboard will check for the existence of the directories
in <code class="docutils literal notranslate"><span class="pre">OodFilesApp.candidate_favorite_paths</span></code> array and whichever directories
exist and the user has access to will appear as links in the Files menu under
the Home Directory link.</p>
<div class="figure align-center" id="id28">
<img alt="_images/files_menu_shortcuts_osc.png" src="_images/files_menu_shortcuts_osc.png" />
<p class="caption"><span class="caption-number">Fig. 4 </span><span class="caption-text">Shortcuts to scratch and project space directories in Files menu in OSC OnDemand.</span><a class="headerlink" href="#id28" title="Permalink to this image">¶</a></p>
</div>
<ul class="simple">
<li><p>You must restart the Dashboard app to see a configuration change take effect.
This can be forced from the Dashboard itself by selecting
<em>Help</em> → <em>Restart Web Server</em> from the top right menu.</p></li>
</ul>
<p>If you access the Dashboard, and it crashes, then you may have made a mistake
in <code class="docutils literal notranslate"><span class="pre">ood.rb</span></code> file, whose code is run during the initialization of the Rails
app.</p>
</div>
<div class="section" id="configuration-profiles">
<span id="profiles-guide"></span><h2>Configuration Profiles<a class="headerlink" href="#configuration-profiles" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The profile based configuration is an experimental feature. Not all properties have been migrated to be compatible.
See the list of supported properties in the <a class="reference internal" href="reference/files/ondemand-d-ymls.html#profile-properties"><span class="std std-ref">configuration documentation</span></a></p>
</div>
<p>Configuration properties can be organized in a hierarchy using profiles. With profiles,
administrators can create different configuration settings within the same OnDemand installation.
A profile can be pre-selected or dynamically changed while using the Dashboard application.</p>
<p>To define profile properties, we have to group them under a profile name within the <code class="docutils literal notranslate"><span class="pre">profiles</span></code> keyword.
Multiple profiles can be created using different files, the configuration
logic will aggregate all profiles into a single consolidated object.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">profiles</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">profile_name</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">config_property</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config_value</span><span class="w"></span>
</pre></div>
</div>
<p>OnDemand uses an inheritance and override approach for profiles.
The root profile is the default profile created by the system based on all the properties defined
outside any profile definition. All other profiles will inherit these values.</p>
<p>Then, profile properties can override these values or define new ones as required.</p>
<p>The example below shows how the root profile defines a value for <code class="docutils literal notranslate"><span class="pre">pinned_apps</span></code> and <code class="docutils literal notranslate"><span class="pre">pinned_apps_menu_length</span></code> properties.
The <code class="docutils literal notranslate"><span class="pre">rstudio_group</span></code> profile inherits the property value for <code class="docutils literal notranslate"><span class="pre">pinned_apps_menu_length</span></code>,
and overrides the value for <code class="docutils literal notranslate"><span class="pre">pinned_apps</span></code>. As well, it defines a value for the property <code class="docutils literal notranslate"><span class="pre">pinned_apps_group_by</span></code>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">pinned_apps</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">sys/*</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="nt">pinned_apps_menu_length</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span><span class="w"></span>

<span class="nt">profiles</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">rstudio_group</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">pinned_apps</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">sys/rstudio</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">    </span><span class="nt">pinned_apps_group_by</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;department&quot;</span><span class="w"></span>
</pre></div>
</div>
<div class="section" id="manual-profile-selection">
<span id="profiles-selection-guide"></span><h3>Manual Profile Selection<a class="headerlink" href="#manual-profile-selection" title="Permalink to this headline">¶</a></h3>
<p>The selection of a profile can be done manually by updating the user settings profile. By default the root profile is selected.
Profile selection can be done using configurable navigation links.
These links will update the profile, save the newly selected profile in the user settings file and reload the Dashboard.</p>
<p>To add profile links to the Help navigation dropdown menu use the configuration property <code class="docutils literal notranslate"><span class="pre">profile_links</span></code>.
For more information on how to add profile links to the navigation bar in various places, see
<a class="reference internal" href="#menus-for-profile-links"><span class="std std-ref">menus for profile links</span></a>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">profile_links</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Profiles&quot;</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">profile</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Root</span><span class="nv"> </span><span class="s">Profile&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">icon</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;fas://cog&quot;</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">profile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rstudio_group</span><span class="w"></span>
<span class="w">    </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Rstudio</span><span class="nv"> </span><span class="s">Profile&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">icon</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;fas://user&quot;</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">profile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jupyter_group</span><span class="w"></span>
<span class="w">    </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Jupiter</span><span class="nv"> </span><span class="s">Profile&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">icon</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;fas://user&quot;</span><span class="w"></span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="_images/def-profiles-links.png" src="_images/def-profiles-links.png" />
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Use the <code class="docutils literal notranslate"><span class="pre">group</span></code> property to add a section header or to organize your profiles as shown above.
Profile links can be configured as well using the <a class="reference internal" href="#help-menu-guide"><span class="std std-ref">Help menu customizations</span></a>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Your profile selection is stored in your OnDemand user settings file.
The <code class="docutils literal notranslate"><span class="pre">profile</span></code> key in this YAML file provides the value used to select your current profile.
The user settings file is stored in your OnDemand data folder, this is usually <code class="docutils literal notranslate"><span class="pre">~/ondemand/data/sys/dashboard/.ood</span></code>.
Manual updates to this file will require an application restart to load the new values.</p>
</div>
</div>
<div class="section" id="automatic-profile-selection">
<h3>Automatic Profile Selection<a class="headerlink" href="#automatic-profile-selection" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p><strong>Request Hostname profile selection:</strong> use the current request hostname as the selected profile.
To enable this feature, set the configuration property <code class="docutils literal notranslate"><span class="pre">host_based_profiles</span></code> to <code class="docutils literal notranslate"><span class="pre">true</span></code>.
A request to <code class="docutils literal notranslate"><span class="pre">https://www.ondemand.com/pun/sys/dashboard</span></code> will use <code class="docutils literal notranslate"><span class="pre">www.ondemand.com</span></code> as the selected profile name.</p>
<p>Configure the profiles using the hostname and the system will use the profile properties automatically.</p>
</li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">profiles</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">www.ondemand.com</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">config_property</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config_value</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you have a need to create multiple profile definitions that have the same configuration, you could use aliases.
This is a feaure of YAML files. You can use YAML <code class="docutils literal notranslate"><span class="pre">anchors</span></code> and <code class="docutils literal notranslate"><span class="pre">aliases</span></code> to set the same profile configuration
to more than one definition without duplication. This YAML feature only works when defined and used within the same file.</p>
<p>The example below creates 4 profiles all with the same configuration:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">profiles</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">www.production.com</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;production_profile</span><span class="w"> </span><span class="c1"># Anchor definition</span><span class="w"></span>
<span class="w">    </span><span class="nt">config_property</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config_value</span><span class="w"></span>
<span class="w">    </span><span class="nt">config_property</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config_value</span><span class="w"></span>
<span class="w">    </span><span class="nt">config_property</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config_value</span><span class="w"></span>

<span class="w">  </span><span class="nt">www.local.com</span><span class="p">:</span><span class="w"> </span><span class="nv">*production_profile</span><span class="w"> </span><span class="c1"># Defining an alias to the previously set anchor.</span><span class="w"></span>
<span class="w">  </span><span class="nt">www.test.com</span><span class="p">:</span><span class="w"> </span><span class="nv">*production_profile</span><span class="w"></span>
<span class="w">  </span><span class="nt">www.staging.com</span><span class="p">:</span><span class="w"> </span><span class="nv">*production_profile</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="changing-the-navigation-bar">
<span id="navbar-guide"></span><h2>Changing the Navigation bar<a class="headerlink" href="#changing-the-navigation-bar" title="Permalink to this headline">¶</a></h2>
<p>There are a couple ways to change the navigation bar in Open OnDemand, some
are simpler than others.</p>
<p>This section provides the outline of how the navigation bar is generated to begin
with, then details the various ways to modify it.</p>
<p>Once you understand how the navigation bar is generated automatically,
you can take steps to custimize it as you see fit.</p>
<div class="section" id="understanding-the-default-navigation-bar">
<span id="understanding-default-nav-bar"></span><h3>Understanding the default navigation bar<a class="headerlink" href="#understanding-the-default-navigation-bar" title="Permalink to this headline">¶</a></h3>
<p>Some navigation menus and links are built-in to the system. The system
will generate dropdown menus for <code class="docutils literal notranslate"><span class="pre">Files</span></code>, <code class="docutils literal notranslate"><span class="pre">Jobs</span></code>, <code class="docutils literal notranslate"><span class="pre">Clusters</span></code> and
<code class="docutils literal notranslate"><span class="pre">Interactive</span> <span class="pre">Apps</span></code> automatically. It will also generate the link for
<code class="docutils literal notranslate"><span class="pre">My</span> <span class="pre">Interactive</span> <span class="pre">Sessions</span></code> by default.</p>
<p>Here’s an image of you’d expect to see by default.</p>
<div class="figure align-center">
<img alt="An image of the default navigation bar showing dropdown menus for files, jobs, clusters, interactive apps, and my interactive apps." src="_images/main-navigation-menu.png" />
</div>
<p>Open OnDemand is a platform for other applications, like Jupyter &amp; RStudio.
As such, the default navigation bar builds itself based on what applications
it has discovered.  The system will search <code class="docutils literal notranslate"><span class="pre">/var/www/ood/apps/sys/</span></code> for these
applications.</p>
<p>Every application should have <a class="reference internal" href="how-tos/app-development/interactive/manifest.html#app-development-manifest"><span class="std std-ref">Manifest yml files</span></a>.  The system reads
these manifests files and builds additional dropdown menus (or adds to existing menus)
based on the <code class="docutils literal notranslate"><span class="pre">category</span></code> field.</p>
<p>By default, the system will generate a new dropdown menu for every <code class="docutils literal notranslate"><span class="pre">category</span></code>
it encounters.  Within each dropdown menu it will add seperators for each
<code class="docutils literal notranslate"><span class="pre">subcategory</span></code> it encounters.</p>
</div>
<div class="section" id="limit-auto-generated-menu-bars">
<span id="id4"></span><h3>Limit auto generated menu bars<a class="headerlink" href="#limit-auto-generated-menu-bars" title="Permalink to this headline">¶</a></h3>
<p>As described in the previous section, the system will generate new dropdown
menus for every <code class="docutils literal notranslate"><span class="pre">category</span></code> it discovers.</p>
<p>If you wish to add or remove which categories create dropdown menus
use the <a class="reference internal" href="reference/files/ondemand-d-ymls.html#nav-categories"><span class="std std-ref">nav_categories configuration property</span></a>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Should you need more granular control over the navigation bar,
read <a class="reference internal" href="#fully-customizing-the-navbar"><span class="std std-ref">Fully customizing the navigation bar</span></a> below.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Prior to 2.1, controlling which categories appear in the navigation bar was controlled
by a Ruby initializer that you needed to modify. While the 2.x series will still support
this scheme, Open OnDemand 3.0 will not.  3.0 will only support the <code class="docutils literal notranslate"><span class="pre">nav_categories</span></code>
property.</p>
<p>Here is the <a class="reference external" href="https://osc.github.io/ood-documentation/release-2.0/customization.html#control-which-apps-appear-in-the-dashboard-navbar">2.0 documentation for controling the navbar</a>.</p>
</div>
</div>
<div class="section" id="using-manifests-to-create-menu-items">
<h3>Using manifests to create menu items<a class="headerlink" href="#using-manifests-to-create-menu-items" title="Permalink to this headline">¶</a></h3>
<p>As described in <a class="reference internal" href="#understanding-default-nav-bar"><span class="std std-ref">Understanding the default navigation bar</span></a>, the system automatically
creates dropdown menus based on the applications it encounters.</p>
<p>So, with that knowledge, one can create or add to dropdown menus by creating
applications with the correct information in their <a class="reference external" href="app-development-manifest">manifest.yml</a>.</p>
<p>It’s fairly simple to make this application. Simply create the directory in the correct location
and create a <a class="reference external" href="app-development-manifest">manifest.yml</a>.</p>
<ul>
<li><p>sudo mkdir /var/www/ood/apps/sys/&lt;NEW MENU ITEM&gt;</p></li>
<li><p>sudo vi /var/www/ood/apps/sys/&lt;NEW MENU ITEM&gt;/manifest.yml</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span><span class="w"></span>
<span class="c1"># This is the text that will show up in the dropdown menu.</span><span class="w"></span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Add Menu Items to the navbar</span><span class="w"></span>

<span class="c1"># This will create the &#39;Links&#39; dropdown menu if it doesn&#39;t already exist.</span><span class="w"></span>
<span class="nt">category</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Links</span><span class="w"></span>
<span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span><span class="w"></span>
<span class="w">  </span><span class="no">A description of what the menu item does.</span><span class="w"></span>
<span class="nt">icon</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fa://clock-o</span><span class="w">   </span><span class="c1"># icon for the link.</span><span class="w"></span>
<span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;https://openondemand.org/&#39;</span><span class="w"></span>

<span class="c1"># open link in new browser window or same browser window.</span><span class="w"></span>
<span class="nt">new_window</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>This scheme may be fine with one or two additional links. Should you need
more granular control over the navigation bar, read <a class="reference internal" href="#fully-customizing-the-navbar"><span class="std std-ref">Fully customizing the navigation bar</span></a>
below.</p>
</div>
</div>
<div class="section" id="fully-customizing-the-navigation-bar">
<span id="fully-customizing-the-navbar"></span><h3>Fully customizing the navigation bar<a class="headerlink" href="#fully-customizing-the-navigation-bar" title="Permalink to this headline">¶</a></h3>
<p>Since 2.1, Open OnDemand provides a way to completely control the navigation bar
through the <code class="docutils literal notranslate"><span class="pre">nav_bar</span></code> and <code class="docutils literal notranslate"><span class="pre">help_bar</span></code> <a class="reference internal" href="reference/files/ondemand-d-ymls.html#ondemand-d-ymls"><span class="std std-ref">ondemand.d/*.yml files</span></a> configuration properties.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>As described in <a class="reference internal" href="#understanding-default-nav-bar"><span class="std std-ref">Understanding the default navigation bar</span></a>, the system auto-generates
dropdown menus based on the applications it discovers.  If the <code class="docutils literal notranslate"><span class="pre">nav_bar</span></code> or
<code class="docutils literal notranslate"><span class="pre">help_bar</span></code> configurations are set, the system will <strong>only</strong> show what you’ve defined.</p>
</div>
<p>Before we look at how to modify it in detail, let’s look at what the default
configuration would be (without showing any discovered apps).</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># &#39;nav_bar&#39; is the left side of the navigation bar.</span><span class="w"></span>
<span class="nt">nav_bar</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="c1"># &#39;apps&#39; dropdown menu is shown if you&#39;ve set &#39;pinned_apps&#39;.</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">files</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jobs</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">clusters</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">interactive apps</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my interactive sessions</span><span class="w"></span>

<span class="w">  </span><span class="c1"># &#39;all apps&#39; is disabled by default, but would be next if you set &#39;show_all_apps_link&#39;.</span><span class="w"></span>
<span class="w">  </span><span class="c1"># - all apps</span><span class="w"></span>

<span class="c1"># &#39;help_bar&#39; is the right side of the navigation bar.</span><span class="w"></span>
<span class="nt">help_bar</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">develop</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">help</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">logout</span><span class="w"></span>
</pre></div>
</div>
<p>The configuration above would be equvialent to the default navigation bar as described
in <a class="reference internal" href="#understanding-default-nav-bar"><span class="std std-ref">Understanding the default navigation bar</span></a>.</p>
<p>As menus are dynamically discovered <em>from your system</em>, this documentation can only cover
how a fresh install - with no other applications - would behave.</p>
<p>A custom navigation definition is a list of navigation items.
A navigation item could be a navigation menu or a navigation link.
A navigation menu contains a list of navigation links with optional link groups.</p>
<p>There are several ways of creating a navigation menu.</p>
<div class="section" id="menus-by-application-category">
<h4>Menus by Application category<a class="headerlink" href="#menus-by-application-category" title="Permalink to this headline">¶</a></h4>
<p>One of the easiest ways to create menus is to create them based off of
the applications categories.</p>
<p>The title of the dropdown menu will be the <code class="docutils literal notranslate"><span class="pre">category</span></code> itself, and menu items
(applications) will be grouped by their <code class="docutils literal notranslate"><span class="pre">subcategory</span></code>. It is not possible to
set an icon. The <code class="docutils literal notranslate"><span class="pre">category</span></code> matching is case insensitive.</p>
<p>Here’s an example using the <code class="docutils literal notranslate"><span class="pre">interactive</span> <span class="pre">apps</span></code> <code class="docutils literal notranslate"><span class="pre">category</span></code>. Just like the default
navigation bar, this will generate a dropdown menu of all the applications the system
has discovered in that <code class="docutils literal notranslate"><span class="pre">category</span></code>.</p>
<p>As you can see from the image, the system has discovered eight applications in two
subcategories.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">nav_bar</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;interactive</span><span class="nv"> </span><span class="s">apps&quot;</span><span class="w"></span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="An open dropdown menu titled &quot;Interactive Apps&quot;. The first submenu is titled &quot;Desktops&quot; and has two list items. The second submenu is titled &quot;Servers&quot; and has six list items." src="_images/def-category-menu.png" />
</div>
</div>
<div class="section" id="predefined-templates">
<h4>Predefined templates<a class="headerlink" href="#predefined-templates" title="Permalink to this headline">¶</a></h4>
<p>As you can see from the example default configuration in <a class="reference internal" href="#fully-customizing-the-navbar">fully-customizing-the-navbar</a>, there
are several pre-defined navigation menus that you can use.</p>
<p>A complete list of predefined templates is:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">all_apps</span></code> - The link to the all applications page.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">apps</span></code> - A drop down menu of <code class="docutils literal notranslate"><span class="pre">pinned_apps</span></code>. Note that you need to set <code class="docutils literal notranslate"><span class="pre">pinned_apps</span></code> for this to show up.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sessions</span></code> - The link to “My Interactive Sessions” page.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">develop</span></code> - The dropdown menu for developers, titled “Develop”.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">help</span></code> - The “Help” dropdown menu.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">log_out</span></code> - The link to logout, titled “Logout”.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">user</span></code> - The “Logged in as &lt;user&gt;” text.</p></li>
</ul>
<p>Here’s an example of defining all of them and what that would look like.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">nav_bar</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;all_apps&quot;</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;apps&quot;</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;sessions&quot;</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;develop&quot;</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;help&quot;</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;log_out&quot;</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;user&quot;</span><span class="w"></span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="An image of the navigation bar. From left to right the items are &quot;All Apps&quot; link, &quot;Apps&quot; dropdown menu, &quot;My Interactive Sesssions&quot; link, &quot;Develop&quot; drop down menu, &quot;Help&quot; drop down menu, &quot;Logout&quot; link and 'logged in as ood' text." src="_images/def-templates-menu.png" />
</div>
</div>
<div class="section" id="menus-based-on-applications">
<span id="id6"></span><h4>Menus based on applications<a class="headerlink" href="#menus-based-on-applications" title="Permalink to this headline">¶</a></h4>
<p>You can create dropdown menus based on applications the system can discover.</p>
<p>Menu items are automatically grouped based on the applications <code class="docutils literal notranslate"><span class="pre">subcategory</span></code>.
Use the <code class="docutils literal notranslate"><span class="pre">apps</span></code> array to define the app tokens for this navigation menu.</p>
<p>The order of the menu items is based on the order you’ve defined.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">nav_bar</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;My</span><span class="nv"> </span><span class="s">Apps&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">icon</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;fas://window-restore&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">apps</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;sys/Rstudio/*&quot;</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;sys/bc_desktop&quot;</span><span class="w"></span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="An open dropdown menu titled &quot;My Apps&quot;. The menu shows two submenus. The first is titled &quot;Servers&quot; and has five list items for all the discovered through the &quot;sys/Rstudio/*&quot; configuration. The second submenu is titled &quot;Desktops&quot; and has one list item for the discovered through the &quot;sys/bc_desktop&quot; configuration." src="_images/def-apps-menu.png" />
</div>
</div>
<div class="section" id="menus-based-on-links">
<span id="id7"></span><h4>Menus based on links<a class="headerlink" href="#menus-based-on-links" title="Permalink to this headline">¶</a></h4>
<p>Menus based on links provide even more granular control on how the dropdown menu is generated.</p>
<p>As seen in the previous sections, using an <code class="docutils literal notranslate"><span class="pre">apps</span></code> array will automatically generate
submenus based on the <code class="docutils literal notranslate"><span class="pre">subcategory</span></code> of the applications that have been discovered.</p>
<p>When using links, we can override this behaviour to provide different titles to
the submenus, or with no submenus and subtitles at all.</p>
<p>Let’s look at this example using the same application tokens, but using <code class="docutils literal notranslate"><span class="pre">links</span></code> instead
of <code class="docutils literal notranslate"><span class="pre">apps</span></code>. The system will discover and generate list items for the same eight applications,
only without <strong>any</strong> submenus.  It is simply a list of all the discovered applications with
no further grouping.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">nav_bar</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;My</span><span class="nv"> </span><span class="s">Apps&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">icon</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;fa://code&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">links</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;sys/Rstudio/*&quot;</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;sys/bc_desktop&quot;</span><span class="w"></span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="An open dropdown menu titled &quot;My Apps&quot;. The menu has no submenus. It simply lists all eight the apps." src="_images/app-links-no-group.png" />
</div>
<p>To add submenus, simply use the <code class="docutils literal notranslate"><span class="pre">group</span></code> attribute.</p>
<p>When <code class="docutils literal notranslate"><span class="pre">links</span></code> are used with the <code class="docutils literal notranslate"><span class="pre">group</span></code> attribute, the discovered applications
will now be grouped and submenu titles created based on the configuration provided.</p>
<p>This will look and feel similar to <a class="reference internal" href="#menus-based-on-applications">menus-based-on-applications</a> with the exception
being that submenus are defined by the <code class="docutils literal notranslate"><span class="pre">group</span></code> configuration instead of the <code class="docutils literal notranslate"><span class="pre">subcategory</span></code>
of the applications in the list.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">nav_bar</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;My</span><span class="nv"> </span><span class="s">Apps&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">icon</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;fa://code&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">links</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;RStudio&quot;</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;sys/Rstudio/*&quot;</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Remote&quot;</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;sys/bc_desktop&quot;</span><span class="w"></span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="An image showing one open drop down menu titled &quot;My Apps&quot;. The first submenu, titled &quot;Rstudio&quot; has five list items that have been discovered through the &quot;sys/Rstudio/*&quot; configuration. The second submenu, titled &quot;Remote&quot; has one list item that has been discovered through the &quot;sys/bc_desktop&quot; configuration." src="_images/def-full-menu.png" />
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can also used predefined links (described above) in the <code class="docutils literal notranslate"><span class="pre">links</span></code> section here.</p>
</div>
</div>
<div class="section" id="menus-for-profile-links">
<span id="id8"></span><h4>Menus for profile links<a class="headerlink" href="#menus-for-profile-links" title="Permalink to this headline">¶</a></h4>
<p>If you’ve enabled <cite>Profiles &lt;profiles_guide&gt;</cite> you can create navigation bar menus and
links to those profiles through the <code class="docutils literal notranslate"><span class="pre">profile</span></code> attribute.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">nav_bar</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="c1"># Single top level link</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Title&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">icon</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;fa://desktop&quot;</span><span class="w"> </span><span class="c1"># optional, defaults to fas://cog</span><span class="w"></span>
<span class="w">    </span><span class="nt">profile</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;team1&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">new_tab</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"> </span><span class="c1"># optional, defaults to false</span><span class="w"></span>

<span class="w">  </span><span class="c1"># Dropdown menu</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Menu</span><span class="nv"> </span><span class="s">Item&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">links</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Title&quot;</span><span class="w"></span>
<span class="w">        </span><span class="nt">icon</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;fa://desktop&quot;</span><span class="w"> </span><span class="c1"># optional, defaults to fas://cog</span><span class="w"></span>
<span class="w">        </span><span class="nt">profile</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;team1&quot;</span><span class="w"></span>
<span class="w">        </span><span class="nt">new_tab</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"> </span><span class="c1"># optional, defaults to false</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="menus-for-custom-pages">
<span id="id9"></span><h4>Menus for custom pages<a class="headerlink" href="#menus-for-custom-pages" title="Permalink to this headline">¶</a></h4>
<p>If you’ve enabled <a class="reference internal" href="#custom-pages-guide">custom_pages_guide</a> you can create navigation menus
or single links directly to those pages through the the <code class="docutils literal notranslate"><span class="pre">page</span></code> attribute.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">nav_bar</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="c1"># Single top level link</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Title&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">icon</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;fa://desktop&quot;</span><span class="w"> </span><span class="c1"># optional, defaults to fas://cog</span><span class="w"></span>
<span class="w">    </span><span class="nt">page</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;documentation&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">new_tab</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"> </span><span class="c1"># optional, defaults to false</span><span class="w"></span>

<span class="w">  </span><span class="c1"># Dropdown menu</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Menu</span><span class="nv"> </span><span class="s">Item&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">links</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Title&quot;</span><span class="w"></span>
<span class="w">        </span><span class="nt">icon</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;fa://desktop&quot;</span><span class="w"> </span><span class="c1"># optional, defaults to fas://cog</span><span class="w"></span>
<span class="w">        </span><span class="nt">page</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;documentation&quot;</span><span class="w"></span>
<span class="w">        </span><span class="nt">new_tab</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"> </span><span class="c1"># optional, defaults to false</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="menus-for-urls">
<span id="id10"></span><h4>Menus for URLs<a class="headerlink" href="#menus-for-urls" title="Permalink to this headline">¶</a></h4>
<p>You can even create menu items for relative and absolute URLs to link anywhere
through the <code class="docutils literal notranslate"><span class="pre">url</span></code> attribute.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">nav_bar</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="c1"># Single top level link</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Title&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">icon</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;fa://desktop&quot;</span><span class="w"> </span><span class="c1"># optional, defaults to fas://cog</span><span class="w"></span>
<span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/docs&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">new_tab</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"> </span><span class="c1"># optional, defaults to false</span><span class="w"></span>

<span class="w">  </span><span class="c1"># Dropdown menu</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Menu</span><span class="nv"> </span><span class="s">Item&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">links</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Title&quot;</span><span class="w"></span>
<span class="w">        </span><span class="nt">icon</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;fa://desktop&quot;</span><span class="w"> </span><span class="c1"># optional, defaults to fas://cog</span><span class="w"></span>
<span class="w">        </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://openondemand.org/&quot;</span><span class="w"></span>
<span class="w">        </span><span class="nt">new_tab</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"> </span><span class="c1"># optional, defaults to false</span><span class="w"></span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="An image of the navigation bar with a single link &quot;Title&quot; and an open dropdown menu titled &quot;Menu Item&quot;. The dropdown menu has one list item titled &quot;Title&quot;." src="_images/def-navigation-link.png" />
</div>
</div>
</div>
</div>
<div class="section" id="interactive-apps-menu">
<span id="interactive-apps-menu-guide"></span><h2>Interactive Apps Menu<a class="headerlink" href="#interactive-apps-menu" title="Permalink to this headline">¶</a></h2>
<p>To define a custom interactive apps menu, use the configuration property <code class="docutils literal notranslate"><span class="pre">interactive_apps_menu</span></code>.
The custom menu will replace the <code class="docutils literal notranslate"><span class="pre">Interactive</span> <span class="pre">Apps</span></code> left hand side navigation in the
<em>Interactive Apps</em> and <em>My Interactive Sessions</em> pages.</p>
<div class="figure align-center">
<img alt="_images/interactive-apps-menu.png" src="_images/interactive-apps-menu.png" />
</div>
<p><code class="docutils literal notranslate"><span class="pre">interactive_apps_menu</span></code> property supports a single navigation item. How to configure navigation items is described in the
<a class="reference internal" href="#navbar-guide"><span class="std std-ref">Custom Dashboard Navbar section</span></a></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">interactive_apps_menu</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Custom</span><span class="nv"> </span><span class="s">Apps&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">links</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Desktop&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apps</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;sys/bc_desktop&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Servers&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apps</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;sys/Rstudio/*&quot;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="set-upload-limits">
<span id="id11"></span><h2>Set Upload Limits<a class="headerlink" href="#set-upload-limits" title="Permalink to this headline">¶</a></h2>
<p>By default, the file size upload limit is 10737420000 bytes (~10.7 GB).</p>
<p>If you want set this to a lower value, set the <code class="docutils literal notranslate"><span class="pre">FILE_UPLOAD_MAX</span></code> configuration
in the file apps’ configuration file <code class="docutils literal notranslate"><span class="pre">/etc/ood/config/apps/shell/env</span></code>.</p>
<p>If you want to set it to a higher value set <code class="docutils literal notranslate"><span class="pre">nginx_file_upload_max</span></code>
in <code class="docutils literal notranslate"><span class="pre">/etc/ood/config/nginx_stage.yml</span></code> to the desired value. If you have
<code class="docutils literal notranslate"><span class="pre">FILE_UPLOAD_MAX</span></code> set from above, unset it.</p>
<p>If the values differ, the files app will choose the smaller of the two as the maximum
upload limit.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Both of these configurations are expected to be numbers only (no characters)
and in units of bytes. The default value of 10737420000 bytes is ~10.7 GB or ~10.0 Gib.</p>
<p>Values like <code class="docutils literal notranslate"><span class="pre">1000M</span></code> or <code class="docutils literal notranslate"><span class="pre">20G</span></code> will not be accepted and may cause errors.</p>
</div>
<p>If you want to disable file upload altogether, set <code class="docutils literal notranslate"><span class="pre">FILE_UPLOAD_MAX</span></code> to 0 and leave
the <code class="docutils literal notranslate"><span class="pre">nginx_file_upload_max</span></code> configuration alone (or comment it out so the default
is used).</p>
</div>
<div class="section" id="block-or-allow-directory-access">
<h2>Block or Allow Directory Access<a class="headerlink" href="#block-or-allow-directory-access" title="Permalink to this headline">¶</a></h2>
<p>By default, all directories are open and accessible through Open OnDemand (barring POSIX file permissions. Open OnDemand
can never read files the user cannot read).</p>
<p>By setting a colon delimited <cite>OOD_ALLOWLIST_PATH</cite> environment variable, the Job Composer, File Editor, and Files app
respect the allowlist in the following manner:</p>
<ol class="arabic simple">
<li><p>Users will be prevented from navigating to, uploading, downloading, viewing, or editing files that are not an eventual child of the allowlisted paths</p></li>
<li><p>Users will be prevented from copying a template directory from an arbitrary path in the Job Composer if the arbitrary path that is not an eventual child of the allowlisted paths</p></li>
<li><p>Users should not be able to get around this using symlinks</p></li>
</ol>
<p>We recommend setting this environment variable in <code class="docutils literal notranslate"><span class="pre">/etc/ood/config/nginx_stage.yml</span></code> as a YAML mapping (key value pairs) in the mapping (hash/dictionary) <code class="docutils literal notranslate"><span class="pre">pun_custom_env</span></code> i.e. below would a list that allows access to home directories, project space, and scratch space at OSC:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">pun_custom_env</span><span class="p">:</span><span class="w"></span>
<span class="w"> </span><span class="nt">OOD_ALLOWLIST_PATH</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/users:/fs/project:/fs/scratch&quot;</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This is not yet used in production at OSC, so we consider this feature “experimental” for now.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This allowlist is not enforced across every action a user can take in an app (including the developer views in the Dashboard). Also, it is enforced via the apps themselves, which is not as robust as using cgroups on the PUN.</p>
</div>
</div>
<div class="section" id="set-default-ssh-host">
<span id="id12"></span><h2>Set Default SSH Host<a class="headerlink" href="#set-default-ssh-host" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The shell app does not work out of the box because all SSH hosts have to be explicitly allowed
through the allowlist (see the section below).</p>
<p>Because there are no hosts configured, no hosts are allowed.</p>
</div>
<p>In <code class="docutils literal notranslate"><span class="pre">/etc/ood/config/apps/shell/env</span></code> set the env var <code class="docutils literal notranslate"><span class="pre">OOD_DEFAULT_SSHHOST</span></code> to change the default ssh host.
Since 1.8, there is no out of the box default (in previous versions it was ‘localhost’, but this has been removed).</p>
<p>This will control what host the shell app ssh’s to when the URL accessed is <code class="docutils literal notranslate"><span class="pre">/pun/sys/shell/ssh/default</span></code> which is the URL other apps will use (unless there is context to specify the cluster to ssh to).</p>
<p>Since 1.8 you can also set the default ssh host in the cluster configuration as well. Simply add
default=true attribute to the login section like the example below.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># /etc/ood/config/clusters.d/my_cluster.yml</span><span class="w"></span>
<span class="nn">---</span><span class="w"></span>
<span class="nt">v2</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;My</span><span class="nv"> </span><span class="s">Cluster&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">login</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;my_cluster.my_center.edu&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="set-ssh-allowlist">
<span id="id13"></span><h2>Set SSH Allowlist<a class="headerlink" href="#set-ssh-allowlist" title="Permalink to this headline">¶</a></h2>
<p>In 1.8 and above we stopped allowing ssh access by default.  Now you have explicitly set
what hosts users will be allowed to connect to in the shell application.</p>
<p>Every cluster configuration with <code class="docutils literal notranslate"><span class="pre">v2.login.host</span></code> that is not hidden (it has
<code class="docutils literal notranslate"><span class="pre">v2.metadata.hidden</span></code> attribute set to true) will be added to this allowlist.</p>
<p>To add other hosts into the allow list (for example compute nodes) add the configuration
<code class="docutils literal notranslate"><span class="pre">OOD_SSHHOST_ALLOWLIST</span></code> to the <code class="docutils literal notranslate"><span class="pre">/etc/ood/config/apps/shell/env</span></code> file.</p>
<p>This configuration is expected to be a colon (:) separated list of GLOBs.</p>
<p>Here’s an example of of this configuration with three such GLOBs that allow for shell
access into any compute node in our three clusters.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># /etc/ood/config/apps/shell/env</span>
<span class="nv">OOD_SSHHOST_ALLOWLIST</span><span class="o">=</span><span class="s2">&quot;r[0-1][0-9][0-9][0-9].ten.osc.edu:o[0-1][0-9][0-9][0-9].ten.osc.edu:p[0-1][0-9][0-9][0-9].ten.osc.edu&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="shell-app-ssh-command-wrapper">
<h2>Shell App SSH Command Wrapper<a class="headerlink" href="#shell-app-ssh-command-wrapper" title="Permalink to this headline">¶</a></h2>
<p id="ssh-wrapper">Since OOD 1.7 you can use an ssh wrapper script in the shell application instead of just the ssh command.</p>
<p>This is helpful when you pass add additional environment variable through ssh (<code class="docutils literal notranslate"><span class="pre">-o</span> <span class="pre">SendEnv=MY_ENV_VAR</span></code>) or ensure some ssh command options be used.</p>
<p>To use your ssh wrapper configure <code class="docutils literal notranslate"><span class="pre">OOD_SSH_WRAPPER=/usr/bin/changeme</span></code> to point to your script in <code class="docutils literal notranslate"><span class="pre">/etc/ood/config/apps/shell/env</span></code>. Also be sure to make your script executable.</p>
<p>Here’s a simple example of what a wrapper script could look like.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="nv">args</span><span class="o">=</span><span class="s2">&quot;-o SendEnv=MY_ENV_VAR&quot;</span>

<span class="nb">exec</span> /usr/bin/ssh <span class="s2">&quot;</span><span class="nv">$args</span><span class="s2">&quot;</span> <span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="fix-unauthorized-websocket-connection-in-shell-app">
<h2>Fix Unauthorized WebSocket Connection in Shell App<a class="headerlink" href="#fix-unauthorized-websocket-connection-in-shell-app" title="Permalink to this headline">¶</a></h2>
<p>If you see a 401 error when attempting to launch a Shell app session, where the request URL starts with wss:// and the response header includes <code class="docutils literal notranslate"><span class="pre">X-OOD-Failure-Reason:</span> <span class="pre">invalid</span> <span class="pre">origin</span></code>, you may need to set the <code class="docutils literal notranslate"><span class="pre">OOD_SHELL_ORIGIN_CHECK</span></code> configuration option.</p>
<p>There is a security feature that adds proper <a class="reference external" href="https://owasp.org/www-community/attacks/csrf">CSRF</a> protection using both the Origin request header check and a <a class="reference external" href="https://owasp.org/www-community/attacks/csrf">CSRF</a> token check.</p>
<p>The Origin check uses <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Forwarded-Proto">X-Forwarded-Proto</a> and <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Forwarded-Host">X-Forwarded-Host</a> that Apache <a class="reference external" href="https://httpd.apache.org/docs/2.4/mod/mod_proxy.html">mod_proxy</a> sets to build the string that is used to compare with the Origin request header the browser sends in the WebSocket upgrade request.</p>
<p>In some edge cases this string may not be correct, and as a result valid WebSocket connections will be denied. In this case you can either set <code class="docutils literal notranslate"><span class="pre">OOD_SHELL_ORIGIN_CHECK</span></code> env var to the correct https string, or disable the origin check altogether by setting <code class="docutils literal notranslate"><span class="pre">OOD_SHELL_ORIGIN_CHECK=off</span></code> (or any other value that does not start with “http”) in the <code class="docutils literal notranslate"><span class="pre">/etc/ood/config/apps/shell/env</span></code> file.</p>
<p>Either way the CSRF token will still provide protection from this vulnerability.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># /etc/ood/config/apps/shell/env
# to disable it, just configure it with something that doesn&#39;t start with http
OOD_SHELL_ORIGIN_CHECK=&#39;off&#39;

# to change it simply specify the http(s) origin you want to verify against.
OOD_SHELL_ORIGIN_CHECK=&#39;https://my.other.origin&#39;
</pre></div>
</div>
</div>
<div class="section" id="custom-job-composer-templates">
<h2>Custom Job Composer Templates<a class="headerlink" href="#custom-job-composer-templates" title="Permalink to this headline">¶</a></h2>
<p>Below explains how job templates work for the Job Composer and how you can add your own. <a class="reference external" href="https://github.com/OSC/osc-ood-config/tree/5440c0c2f3e3d337df1b0306c9e9d5b80f97a7e4/ondemand.osc.edu/apps/myjobs/templates">Here is an example of the templates we use at OSC for the various clusters we have</a></p>
<div class="section" id="job-templates-overview">
<h3>Job Templates Overview<a class="headerlink" href="#job-templates-overview" title="Permalink to this headline">¶</a></h3>
<p>“Job Composer” attempts to model a simple but common workflow. When creating a new batch job to run a simulation a user may:</p>
<ol class="arabic simple">
<li><p>copy the directory of a job they already ran or an example job</p></li>
<li><p>edit the files</p></li>
<li><p>submit a new job</p></li>
</ol>
<p>“Job Composer” implements these steps by providing the user job template directories and the ability to make copies of them: (1) Copy a directory, (2) Edit the files, and (3) Submit a new job.</p>
<ol class="arabic simple">
<li><p>Copy a directory of a job already ran or an example job</p>
<ol class="arabic simple">
<li><p>User can create a new job from a “default” template. A custom default template can be defined at <code class="docutils literal notranslate"><span class="pre">/etc/ood/config/apps/myjobs/templates/default</span></code> or under the app deployment directory at <code class="docutils literal notranslate"><span class="pre">/var/www/ood/apps/sys/myjobs/templates/default</span></code>. If no default template is specified, the default is <code class="docutils literal notranslate"><span class="pre">/var/www/ood/apps/sys/myjobs/example_templates/torque</span></code></p></li>
<li><p>user can select a directory to copy from a list of “System” templates the admin copied to <code class="docutils literal notranslate"><span class="pre">/etc/ood/config/apps/myjobs/templates</span></code> or under the app deployment directory at <code class="docutils literal notranslate"><span class="pre">/var/www/ood/apps/sys/myjobs/templates</span></code> during installation</p></li>
<li><p>user can select a directory to copy from a list of “User” templates that the user has copied to <code class="docutils literal notranslate"><span class="pre">$HOME/ondemand/data/sys/myjobs/templates</span></code></p></li>
<li><p>user can select a job directory to copy that they already created through “Job Composer” from <code class="docutils literal notranslate"><span class="pre">$HOME/ondemand/data/sys/myjobs/projects/default</span></code></p></li>
</ol>
</li>
<li><p>Edit the files</p>
<ol class="arabic simple">
<li><p>user can open the copied job directory in the File Explorer and edit files using the File Editor</p></li>
</ol>
</li>
<li><p>Submit a new job</p>
<ol class="arabic simple">
<li><p>user can use the Job Options form specify which host to submit to, what file is the job script</p></li>
<li><p>user can use the web interface to submit the job to the batch system</p></li>
<li><p>after the job is completed, the user can open the directory in the file explorer to view results</p></li>
</ol>
</li>
</ol>
</div>
<div class="section" id="job-template-details">
<h3>Job Template Details<a class="headerlink" href="#job-template-details" title="Permalink to this headline">¶</a></h3>
<p>A template consists of a folder and a <cite>manifest.yml</cite> file.</p>
<p>The folder contains files and scripts related to the job.</p>
<p>The manifest contains additional metadata about a job, such as a name, the default host, the submit script file name, and any notes about the template.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">A Template Name</span><span class="w"></span>
<span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ruby</span><span class="w"></span>
<span class="nt">script</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ruby.sh</span><span class="w"></span>
<span class="nt">notes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Notes about the template, such as content and function.</span><span class="w"></span>
</pre></div>
</div>
<p>In the event that a job is created from a template that is missing from the <cite>manifest.yml</cite>, “Job Composer” will assign the following default values:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code> The name of the template folder.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">host</span></code> The cluster id of the first cluster with a valid resource_mgr listed in the OOD cluster config</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">script</span></code> The first <code class="docutils literal notranslate"><span class="pre">.sh</span></code> file appearing in the template folder.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">notes</span></code> The path to the location where a template manifest should be located.</p></li>
</ul>
</div>
</div>
<div class="section" id="job-composer-script-size-limit">
<h2>Job Composer Script Size Limit<a class="headerlink" href="#job-composer-script-size-limit" title="Permalink to this headline">¶</a></h2>
<p>Since 1.7 the Job composer shows users ‘Suggested file(s)’ and ‘Other valid file(s)’. Other valid files are
_any_ files less than <code class="docutils literal notranslate"><span class="pre">OOD_MAX_SCRIPT_SIZE_KB</span></code> which defaults to 65 (meaning 65kb).</p>
<p>To reconfigure this, simply set the environment variable in the job composers’ env file
<code class="docutils literal notranslate"><span class="pre">/etc/ood/config/apps/myjobs/env</span></code> like so:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># show any file less than or equal to 15 kb</span>
<span class="nv">OOD_MAX_SCRIPT_SIZE_KB</span><span class="o">=</span><span class="m">15</span>
</pre></div>
</div>
</div>
<div class="section" id="hiding-job-arrays">
<h2>Hiding Job Arrays<a class="headerlink" href="#hiding-job-arrays" title="Permalink to this headline">¶</a></h2>
<p>When composing a new job, the job arrays field is shown on supported clusters. To Hide this field even on
supported clusters, an option was added.</p>
<p>To reconfigure this, simply set the environment variable in the job composers’ env file
<code class="docutils literal notranslate"><span class="pre">/etc/ood/config/apps/myjobs/env</span></code> like so:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># Don&#39;t show job arrays field even on supported clusters</span>
<span class="nv">OOD_HIDE_JOB_ARRAYS</span><span class="o">=</span>True
</pre></div>
</div>
</div>
<div class="section" id="custom-error-page-for-missing-home-directory-on-launch">
<h2>Custom Error Page for Missing Home Directory on Launch<a class="headerlink" href="#custom-error-page-for-missing-home-directory-on-launch" title="Permalink to this headline">¶</a></h2>
<p>Some sites have the home directory auto-create on first ssh login, for example
via <code class="docutils literal notranslate"><span class="pre">pam_mkhomedir.so</span></code>. This introduces a problem if users first access the system
through OnDemand, which expects the existence of a user’s home directory.</p>
<p>In OnDemand &lt;= 1.3 if the user’s home directory was missing a non-helpful single
string error would display. Now a friendly error page displays. This error page
can be customized by adding a custom one to <code class="docutils literal notranslate"><span class="pre">/etc/ood/config/pun/html/missing_home_directory.html</span></code>.</p>
<p>The default error page looks like this:</p>
<div class="figure align-center">
<img alt="_images/customization_homedirmissing_default.png" src="_images/customization_homedirmissing_default.png" />
</div>
<p>An example of a custom error page has been provided at <code class="docutils literal notranslate"><span class="pre">/opt/ood/nginx_stage/html/missing_home_directory.html.example.pam_mkhomedir</span></code> and can be copied to <code class="docutils literal notranslate"><span class="pre">/etc/ood/config/pun/html/missing_home_directory.html</span></code>. This example directs the user to first click a link to open the shell app which will create the home directory. The shell app’s default host must be configured to be a host that is appropriate for this purpose. The custom error page looks like this:</p>
<div class="figure align-center">
<img alt="_images/customization_homedirmissing_pammkdir.png" src="_images/customization_homedirmissing_pammkdir.png" />
</div>
<p>See <a class="reference external" href="https://discourse.osc.edu/t/launching-ondemand-when-home-directory-does-not-exist/53/">this Discourse discussion</a> for details.</p>
</div>
<div class="section" id="pinning-applications-to-the-dashboard">
<span id="dashboard-pinned-apps"></span><h2>Pinning Applications to the Dashboard<a class="headerlink" href="#pinning-applications-to-the-dashboard" title="Permalink to this headline">¶</a></h2>
<p>In version 2.0 you can now pin app Icons to the dashboard that link to the application form.</p>
<p>When configured a widget like the one below will appear on the dashboard’s landing page.</p>
<div class="figure align-default">
<img alt="_images/pinned_apps.png" src="_images/pinned_apps.png" />
</div>
<p>The configuration for what apps to pin allows for three variants.</p>
<p>You can configure specific apps with a string of the type <code class="docutils literal notranslate"><span class="pre">router/app_name</span></code>.
For example <code class="docutils literal notranslate"><span class="pre">sys/jupyter</span></code> is the system installed app named jupyter.</p>
<p>Secondly you can configure globs like <code class="docutils literal notranslate"><span class="pre">sys/*</span></code> to pin all system installed apps. Or
Maybe <code class="docutils literal notranslate"><span class="pre">sys/minimal_*</span></code> to pin all system installed apps that begin with ‘minimal’.</p>
<p>Lastly you can choose to pin apps based off of fields in their <code class="docutils literal notranslate"><span class="pre">manifest.yml</span></code> file.
You can match by type, category, subcategory and metadata fields.  These matches are
cumulative. Meaning an app has to match <em>all</em> of these to be pinned.  In the examples below
there is a configuration of type sys and category minimal. This configuration will only pin
system installed apps that are in the minimal category.  An app has to meet <em>both</em> these
criteria to be pinned to the dashboard.</p>
<p>Full examples are below:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># /etc/ood/config/ondemand.d/ondemand.yml</span><span class="w"></span>
<span class="nt">pinned_apps</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sys/jupyter</span><span class="w">           </span><span class="c1"># pin a specific system installed app called &#39;jupyter&#39;</span><span class="w"></span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sys/bc_desktop/desk1</span><span class="w">  </span><span class="c1"># pinned desktop app must contain exact desktop name - &#39;desk1&#39;</span><span class="w"></span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;sys/*&#39;</span><span class="w">               </span><span class="c1"># pin all system install apps. This also works for usr/* and dev/*</span><span class="w"></span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">category</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;minimal&#39;</span><span class="w">   </span><span class="c1"># pin all the apps in the &#39;minimal&#39; category</span><span class="w"></span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sys</span><span class="w">             </span><span class="c1"># pin all system installed apps in the minimal category.</span><span class="w"></span>
<span class="w">    </span><span class="nt">category</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;minimal&#39;</span><span class="w"></span>

<span class="w">  </span><span class="c1"># pin all system installed apps in the minimal category and the</span><span class="w"></span>
<span class="w">  </span><span class="c1"># class instruction subcategory</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sys</span><span class="w"></span>
<span class="w">    </span><span class="nt">category</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;minimal&#39;</span><span class="w"></span>
<span class="w">    </span><span class="nt">subcategory</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;class_instruction&#39;</span><span class="w"></span>

<span class="w">  </span><span class="c1"># pin all system installed apps in the minimal category, the</span><span class="w"></span>
<span class="w">  </span><span class="c1"># class instruction subcategory and the metadata field &#39;field_of_science&#39;</span><span class="w"></span>
<span class="w">  </span><span class="c1"># with an exact match on biology</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sys</span><span class="w"></span>
<span class="w">    </span><span class="nt">category</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;minimal&#39;</span><span class="w"></span>
<span class="w">    </span><span class="nt">subcategory</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;class_instruction&#39;</span><span class="w"></span>
<span class="w">    </span><span class="nt">field_of_science</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;biology&#39;</span><span class="w"></span>

<span class="w">  </span><span class="c1"># pin any app with an exact match on the metadata field_of_science of biology</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">field_of_science</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;biology&#39;</span><span class="w"></span>

<span class="w">  </span><span class="c1"># pin any app with an glob match *bio* on the metadata field_of_science</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">field_of_science</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;*bio*&#39;</span><span class="w"></span>
</pre></div>
</div>
<p>Administrators can also configure the pinned apps to be grouped by any field
in the <code class="docutils literal notranslate"><span class="pre">manifest.yml</span></code> including metadata fields with the <code class="docutils literal notranslate"><span class="pre">pinned_apps_group_by</span></code>
configuration.</p>
<p>This will create a row and a heading for each group like so (the image was generated
from grouping by category):</p>
<div class="figure align-default">
<img alt="_images/grouped_pinned_apps.png" src="_images/grouped_pinned_apps.png" />
</div>
<p>One can also change the menu length in the ‘App’s menu item. If you’ve
pinned more than 6 apps and you want to them to show up in this dropdown
list, simply increase the length with the option below.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># /etc/ood/config/ondemand.d/ondemand.yml</span><span class="w"></span>
<span class="nt">pinned_apps_menu_length</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6</span><span class="w">        </span><span class="c1"># the default number of items in the dropdown menu list</span><span class="w"></span>
<span class="nt">pinned_apps_group_by</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">category</span><span class="w">    </span><span class="c1"># defaults to nil, no grouping</span><span class="w"></span>
</pre></div>
</div>
<div class="section" id="pinned-apps-customizations">
<h3>Pinned Apps customizations<a class="headerlink" href="#pinned-apps-customizations" title="Permalink to this headline">¶</a></h3>
<p>To customize the text, icon, or color of the pinned app tile,
use the <code class="docutils literal notranslate"><span class="pre">tile</span></code> configuration property in the application <code class="docutils literal notranslate"><span class="pre">manifest</span></code> or <code class="docutils literal notranslate"><span class="pre">form</span></code>.
The <code class="docutils literal notranslate"><span class="pre">form</span></code> values will take precedence over any set in the <code class="docutils literal notranslate"><span class="pre">manifest</span></code>.
All the values are optional and any set will override the default from the application.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">tile</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Custom</span><span class="nv"> </span><span class="s">Title&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">icon</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fa://desktop</span><span class="w"></span>
<span class="w">  </span><span class="nt">border_color</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;red&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">sub_caption</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="w"></span>
<span class="w">    </span><span class="no">Custom Text Line 1</span><span class="w"></span>
<span class="w">    </span><span class="no">Text Line 2</span><span class="w"></span>
<span class="w">    </span><span class="no">Text Line 3</span><span class="w"></span>
</pre></div>
</div>
<p>The CSS for the pinned app tiles has been optimized to support upto three lines of text for the <code class="docutils literal notranslate"><span class="pre">sub_caption</span></code> property.</p>
<div class="figure align-default">
<img alt="_images/custom_pinned_apps.png" src="_images/custom_pinned_apps.png" />
</div>
</div>
</div>
<div class="section" id="custom-layouts-in-the-dashboard">
<span id="dashboard-custom-layout"></span><h2>Custom layouts in the dashboard<a class="headerlink" href="#custom-layouts-in-the-dashboard" title="Permalink to this headline">¶</a></h2>
<p>Administrators can now customize what widgets appear on the dashboard and how they’re
layed out on the page.</p>
<p>In it’s simplest form this feature allows for a rearrangement of existing widgets. As
of 2.1 the existing widgets are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pinned_apps</span></code> - Pinned Apps described above</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">recently_used_apps</span></code> - the four most recently used interactive applications.
Launching these applications will start a new interactive session with the previously submitted parameters.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sessions</span></code> - the three most recent active interactive sessions</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">motd</span></code> - the Message of the Day</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xdmod_widget_job_efficiency</span></code> - the XDMoD widget for job efficiency</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xdmod_widget_jobs</span></code> - the XDMoD widget for job information</p></li>
</ul>
<p>This feature also allows for administrators to <em>add</em> custom widgets.
Simply drop new files into <code class="docutils literal notranslate"><span class="pre">/etc/ood/config/apps/dashboard/views/widgets</span></code> and reference them
in the configuration. These partial files can be any format Rails recognizes, notably <code class="docutils literal notranslate"><span class="pre">.html</span></code> or
<code class="docutils literal notranslate"><span class="pre">.html.erb</span></code> extensions.</p>
<p>Also if you use subdirectories under widgets, they can be referenced by relative paths. For example
<code class="docutils literal notranslate"><span class="pre">views/widgets/cluster/_my_cluster_widget.html.erb</span></code> would be referenced in the configuration
as <code class="docutils literal notranslate"><span class="pre">cluster/my_cluster_widget</span></code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Rails expects files to be prefixed with an underscore. For example if you configured <code class="docutils literal notranslate"><span class="pre">my_new_widget</span></code>
the filename should be <code class="docutils literal notranslate"><span class="pre">_my_new_widget.html</span></code>.</p>
</div>
<p>Without setting this configuration, the dashboard will arrange itself depending on what features are
enabled. For example if both pinned apps and XDMoD features are enabled it will arrange itself accordingly
based on a default layout.</p>
<p>Here’s the default configuration when all of these features are enabled.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># /etc/ood/config/ondemand.d/ondemand.yml</span><span class="w"></span>
<span class="nt">dashboard_layout</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">rows</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">columns</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">width</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8</span><span class="w"></span>
<span class="w">        </span><span class="nt">widgets</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pinned_apps</span><span class="w"></span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">motd</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">width</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span><span class="w"></span>
<span class="w">        </span><span class="nt">widgets</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">xdmod_widget_job_efficiency</span><span class="w"></span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">xdmod_widget_jobs</span><span class="w"></span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">rows</span></code> are an array of row elements. Each row element has a <code class="docutils literal notranslate"><span class="pre">columns</span></code> field which is an array
column elements. Each column element two fields. A <code class="docutils literal notranslate"><span class="pre">width</span></code> field that specifies the width in the
<a class="reference external" href="https://getbootstrap.com/docs/4.0/layout/grid/">bootstrap grid layout</a> which defaults to 12 columns in total. It also has a <code class="docutils literal notranslate"><span class="pre">widgets</span></code> field which
is an array of existing or newly added widgets to render in that column.</p>
</div>
<div class="section" id="customize-text-in-ondemand">
<span id="customization-localization"></span><h2>Customize Text in OnDemand<a class="headerlink" href="#customize-text-in-ondemand" title="Permalink to this headline">¶</a></h2>
<p>Using Rails support for Internationalization (i18n), we have internationalized many strings in the Dashboard and the Job Composer apps.</p>
<p>Initial translation dictionary files with defaults that work well for OSC and using the English locale (<code class="docutils literal notranslate"><span class="pre">en</span></code>) have been added (<code class="docutils literal notranslate"><span class="pre">/var/www/ood/apps/sys/dashboard/config/locales/en.yml</span></code> and <code class="docutils literal notranslate"><span class="pre">/var/www/ood/apps/sys/myjobs/config/locales/en.yml</span></code>). Sites wishing to modify these strings in order to provide site specific replacements for English, or use a different locale altogether, should do the following:</p>
<ol class="arabic simple">
<li><p>Copy the translation dictionary file (or create a new file with the same structure of the keys you want to modify) to <code class="docutils literal notranslate"><span class="pre">/etc/ood/config/locales/en.yml</span></code> and modify that copy.</p></li>
<li><p>If you want apps to look for these dictionary files in a different location than <code class="docutils literal notranslate"><span class="pre">/etc/ood/config/locales/en.yml</span></code> you can change the location by defining <code class="docutils literal notranslate"><span class="pre">OOD_LOCALES_ROOT</span></code> environment variable.</p></li>
<li><p>The default locale is “en”. You can use a custom locale. For example, if you want the locale to be French, you can create a <code class="docutils literal notranslate"><span class="pre">/etc/ood/config/locales/fr.yml</span></code> and then configure the Dashboard to use this locale by setting the environment variable <code class="docutils literal notranslate"><span class="pre">OOD_LOCALE=fr</span></code> where the locale is just the name of the file without the extension. Do this in either the nginx_stage config or in the Dashboard and Job Composer env config file.</p></li>
</ol>
<p>In each default translation dictionary file the values that are most site-specific (and thus relevant for change) appear at the top.</p>
<table class="docutils align-default" id="id29">
<caption><span class="caption-number">Table 4 </span><span class="caption-text">OnDemand Locale Files</span><a class="headerlink" href="#id29" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head stub"><p>File path</p></th>
<th class="head"><p>App</p></th>
<th class="head"><p>Translation namespace</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><th class="stub"><p><code class="docutils literal notranslate"><span class="pre">/var/www/ood/apps/sys/dashboard/config/locales/en.yml</span></code></p></th>
<td><p><a class="reference external" href="https://github.com/OSC/ondemand/blob/master/apps/dashboard/config/locales/en.yml">Dashboard</a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">dashboard</span></code></p></td>
</tr>
<tr class="row-odd"><th class="stub"><p><code class="docutils literal notranslate"><span class="pre">/var/www/ood/apps/sys/myjobs/config/locales/en.yml</span></code></p></th>
<td><p><a class="reference external" href="https://github.com/OSC/ondemand/blob/master/apps/myjobs/config/locales/en.yml">Job Composer</a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">jobcomposer</span></code></p></td>
</tr>
<tr class="row-even"><th class="stub"><p><code class="docutils literal notranslate"><span class="pre">/etc/ood/config/locales/en.yml</span></code></p></th>
<td><p>All localizable apps will check this path, unless <code class="docutils literal notranslate"><span class="pre">OOD_LOCALES_ROOT</span></code> is set.</p></td>
<td><p>Any</p></td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Translations have certain variables passed to them for example <code class="docutils literal notranslate"><span class="pre">%{support_url}</span></code>. Those variables may be used or removed from the translation. Attempting to use a variable that is not available to the translation will crash the application.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Localization files are YAML documents; remember that YAML uses spaces for indentation NOT tabs per the <a class="reference external" href="https://yaml.org/spec/1.2/spec.html#id2777534">YAML spec</a>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>OnDemand uses the convention that translations that accept HTML with be suffixed with <code class="docutils literal notranslate"><span class="pre">_html</span></code>. Any other translation will be displayed as plain text.</p>
</div>
<div class="section" id="change-the-dashboard-tagline">
<h3>Change the Dashboard Tagline<a class="headerlink" href="#change-the-dashboard-tagline" title="Permalink to this headline">¶</a></h3>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">en</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">dashboard</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">welcome_html</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="w"></span>
<span class="w">      </span><span class="no">%{logo_img_tag}</span><span class="w"></span>
<span class="w">      </span><span class="no">&lt;p class=&quot;lead&quot;&gt;OnDemand provides an integrated, single access point for all of your HPC resources.&lt;/p&gt;</span><span class="w"></span>
<span class="w">    </span><span class="nt">motd_title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Message</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Day&quot;</span><span class="w"></span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">welcome_html</span></code> interpolates the variable <code class="docutils literal notranslate"><span class="pre">logo_img_tag</span></code> with the default
logo, or the logo specified by the environment variable <code class="docutils literal notranslate"><span class="pre">OOD_DASHBOARD_LOGO</span></code>.</p>
<p>You may omit this variable in the value you specify for <code class="docutils literal notranslate"><span class="pre">welcome_html</span></code> if you prefer.</p>
</div>
<div class="section" id="change-quota-messages-in-the-dashboard">
<h3>Change quota messages in the Dashboard<a class="headerlink" href="#change-quota-messages-in-the-dashboard" title="Permalink to this headline">¶</a></h3>
<p>Two messages related to file system usage that sites may want to change:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">quota_additional_message</span></code> - gives the user advice on what to do if they see a quota warning</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">quota_reload_message</span></code> - tells the user that they should reload the page to see their quota usage change, and by default also tells users that the quota values are updated every 5 minutes</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="customize-text-in-the-job-composer-s-options-form">
<h3>Customize Text in the Job Composer’s options form<a class="headerlink" href="#customize-text-in-the-job-composer-s-options-form" title="Permalink to this headline">¶</a></h3>
<p>The OSC-default value for <code class="docutils literal notranslate"><span class="pre">options_account_help</span></code> says that the account field is optional unless a user is a member of multiple projects.</p>
<p>Items of note include what to call Accounts which might also be Charge Codes, or Projects. At OSC entering an account is optional unless a user is a member of multiple projects which is reflected in the default value for the string <code class="docutils literal notranslate"><span class="pre">options_account_help</span></code>.</p>
</div>
</div>
<div class="section" id="disk-quota-warnings-on-dashboard">
<h2>Disk Quota Warnings on Dashboard<a class="headerlink" href="#disk-quota-warnings-on-dashboard" title="Permalink to this headline">¶</a></h2>
<p>You can display warnings to users on the Dashboard if their
disk quota is nearing its limit. This requires an auto-updated (it is
recommended to update this file every <strong>5 minutes</strong> with a cronjob) JSON file
that lists all user quotas. The JSON schema for version <cite>1</cite> is given as:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1525361263</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;quotas&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">    </span><span class="p">{},</span><span class="w"></span>
<span class="w">    </span><span class="p">{}</span><span class="w"></span>
<span class="w">  </span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">version</span></code> defines the version of the JSON schema used, <code class="docutils literal notranslate"><span class="pre">timestamp</span></code>
defines when this file was generated, and <code class="docutils literal notranslate"><span class="pre">quotas</span></code> is a list of quota objects
(see below).</p>
<p>You can configure the Dashboard to use this JSON file (or files) by setting the
environment variable <code class="docutils literal notranslate"><span class="pre">OOD_QUOTA_PATH</span></code> as a colon-delimited list of all JSON
file paths in the <code class="docutils literal notranslate"><span class="pre">/etc/ood/config/apps/dashboard/env</span></code> file. In addition to
pointing to files <code class="docutils literal notranslate"><span class="pre">OOD_QUOTA_PATH</span></code> may also contain HTTP(s) or FTP protocol
URLs. Colons used in URLs are correctly handled and are not treated as delimiters.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Sites using HTTP(s) or FTP for their quota files may see slower dashboard load
times, depending on the responsiveness of the server providing the quota file(s).</p>
</div>
<p>The default threshold for displaying the warning is at 95% (<cite>0.95</cite>), but this
can be changed with the environment variable <code class="docutils literal notranslate"><span class="pre">OOD_QUOTA_THRESHOLD</span></code>.</p>
<p>An example is given as:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># /etc/ood/config/apps/dashboard/env</span>

<span class="nv">OOD_QUOTA_PATH</span><span class="o">=</span><span class="s2">&quot;/path/to/quota1.json:https://example.com/quota2.json&quot;</span>
<span class="nv">OOD_QUOTA_THRESHOLD</span><span class="o">=</span><span class="s2">&quot;0.80&quot;</span>
</pre></div>
</div>
<div class="section" id="individual-user-quota">
<h3>Individual User Quota<a class="headerlink" href="#individual-user-quota" title="Permalink to this headline">¶</a></h3>
<p>If the quota is defined as a <code class="docutils literal notranslate"><span class="pre">user</span></code> quota, then it applies to only disk
resources used by the user alone. This is the default type of quota object and
is given in the following format:</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>A block must be equal to 1 KB for proper conversions.</p>
</div>
</div>
<div class="section" id="individual-fileset-quota">
<h3>Individual Fileset Quota<a class="headerlink" href="#individual-fileset-quota" title="Permalink to this headline">¶</a></h3>
<p>If the quota is defined as a <code class="docutils literal notranslate"><span class="pre">fileset</span></code> quota, then it applies to all disk
resources used underneath a given volume. This requires the object to be
repeated for <strong>each user</strong> that uses disk resources under this given volume.
The format is given as:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;fileset&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;user&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user1&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/path/to/volume2&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;block_usage&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">500</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;total_block_usage&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;block_limit&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2000</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;file_usage&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;total_file_usage&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;file_limit&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">block_usage</span></code> and <code class="docutils literal notranslate"><span class="pre">file_usage</span></code> are the disk resource usages attributed to
the specified user only.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For each user with resources under this fileset, the above object will be repeated with just <code class="docutils literal notranslate"><span class="pre">user</span></code>, <code class="docutils literal notranslate"><span class="pre">block_usage</span></code>, and <code class="docutils literal notranslate"><span class="pre">file_usage</span></code> changing.</p>
</div>
</div>
</div>
<div class="section" id="balance-warnings-on-dashboard">
<span id="id14"></span><h2>Balance Warnings on Dashboard<a class="headerlink" href="#balance-warnings-on-dashboard" title="Permalink to this headline">¶</a></h2>
<p>You can display warnings to users on the Dashboard if their
resource balance is nearing its limit. This requires an auto-updated (it is
recommended to update this file daily with a cronjob) JSON file
that lists all user balances. The JSON schema for version <cite>1</cite> is given as:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1525361263</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;config&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;unit&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RU&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;project_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;project&quot;</span><span class="w"></span>
<span class="w">  </span><span class="p">},</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;balances&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">    </span><span class="p">{},</span><span class="w"></span>
<span class="w">    </span><span class="p">{}</span><span class="w"></span>
<span class="w">  </span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">version</span></code> defines the version of the JSON schema used, <code class="docutils literal notranslate"><span class="pre">timestamp</span></code>
defines when this file was generated, and <code class="docutils literal notranslate"><span class="pre">balances</span></code> is a list of quota objects
(see below).</p>
<p>The value for <code class="docutils literal notranslate"><span class="pre">config.unit</span></code> defines the type of units for balances and
<code class="docutils literal notranslate"><span class="pre">config.project_type</span></code> would be project, account, or group, etc.
Both values are used in locales and can be any string value.</p>
<p>You can configure the Dashboard to use this JSON file (or files) by setting the
environment variable <code class="docutils literal notranslate"><span class="pre">OOD_BALANCE_PATH</span></code> as a colon-delimited list of all JSON
file paths.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Sites using HTTP(s) or FTP for their balance files may see slower dashboard load
times, depending on the responsiveness of the server providing the quota file(s).</p>
</div>
<p>The default threshold for displaying the warning is at <code class="docutils literal notranslate"><span class="pre">0</span></code>, but this
can be changed with the environment variable <code class="docutils literal notranslate"><span class="pre">OOD_BALANCE_THRESHOLD</span></code>.</p>
<p>An example is given as:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># /etc/ood/config/apps/dashboard/env</span>

<span class="nv">OOD_BALANCE_PATH</span><span class="o">=</span><span class="s2">&quot;/path/to/balance1.json:/path/to/balance2.json&quot;</span>
<span class="nv">OOD_BALANCE_THRESHOLD</span><span class="o">=</span><span class="m">1000</span>
</pre></div>
</div>
<div class="section" id="user-balance">
<h3>User Balance<a class="headerlink" href="#user-balance" title="Permalink to this headline">¶</a></h3>
<p>If the balance is defined as a <code class="docutils literal notranslate"><span class="pre">user</span></code> balance, then it applies to only that user. Omit the <code class="docutils literal notranslate"><span class="pre">project</span></code> key:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;user&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user1&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="project-balance">
<h3>Project Balance<a class="headerlink" href="#project-balance" title="Permalink to this headline">¶</a></h3>
<p>If the balance is defined as a <code class="docutils literal notranslate"><span class="pre">project</span></code> balance, then it applies to a project/account/group, whatever is defined for <code class="docutils literal notranslate"><span class="pre">config.project_type</span></code>:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;user&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user1&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;project&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;project1&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="maintenance-mode">
<span id="id15"></span><h2>Maintenance Mode<a class="headerlink" href="#maintenance-mode" title="Permalink to this headline">¶</a></h2>
<p>As an administrator you may want to have some downtime of the Open OnDemand service for various reasons,
while still telling your customers that the downtime is expected.</p>
<p>You can do this by setting Open OnDemand in ‘Maintenance Mode’.
While Maintenance mode is active, Apache will not serve requests for paths outside the
<code class="docutils literal notranslate"><span class="pre">/public/maintenance/*</span></code> wildcard. Instead, it will serve the <code class="docutils literal notranslate"><span class="pre">/var/www/ood/public/maintenance/index.html</span></code>
file, which you can change or brand to be your own. Changes to this file will persist through upgrades.
Any assets (e.g., images, stylesheets, or javascript) needed by the HTML file should be placed
in the <code class="docutils literal notranslate"><span class="pre">/var/www/ood/public/maintenance/</span></code> directory. You can also put symbolic links into the
<code class="docutils literal notranslate"><span class="pre">/var/www/ood/public/maintenance/</span></code> directory, if you want to reuse assets located elsewhere in your
file system.</p>
<p>While in maintenance mode, Apache returns the HTML file and a 503 response code to all users whose
IP does not match one of the configured allowlist regular expressions.
The allowlist is to allow staff, localhost or a subset of your users access while restricting others.</p>
<p>In this example we allow access to anyone from <code class="docutils literal notranslate"><span class="pre">192.168.1..*</span></code> which is the 192.168.1.0/24 CIDR and
the single IP ‘10.0.0.1’.</p>
<p>These are the settings you’ll need for this functionality.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># /etc/ood/config/ood_portal.yml</span><span class="w"></span>
<span class="nt">use_rewrites</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="nt">use_maintenance</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="nt">maintenance_ip_allowlist</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="c1"># examples only! Your ip regular expressions will be specific to your site.</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;192.168.1..*&#39;</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;10.0.0.1&#39;</span><span class="w"></span>
</pre></div>
</div>
<p>To start maintenance mode (and thus start serving this page) simply <code class="docutils literal notranslate"><span class="pre">touch</span> <span class="pre">/etc/ood/maintenance.enable</span></code>
to create the necessary file. When your downtime is complete just remove the file and all the
traffic will be served normally again.  The existence of this file is what starts or stops maintenance
mode, not it’s content, so you will not need to restart apache or modify it’s config files for this to
take affect.</p>
</div>
<div class="section" id="grafana-support">
<span id="id16"></span><h2>Grafana support<a class="headerlink" href="#grafana-support" title="Permalink to this headline">¶</a></h2>
<p>It’s possible to display Grafana graphs within the ActiveJobs app when a user expands a given job.</p>
<p>Grafana must be configured to support embedded panels and at this time it is also required to have a anonymous organization.  Below are configuration options are needed to support displaying Grafana panels in ActiveJobs. Adjust <cite>org_name</cite> to match whatever organization you wish to be anonymous.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Changing a Grafana install to support anonymous access can cause unintended consequences for how authenticated users interact with Grafana.
It’s recommended to test anonymous access on a non-production Grafana install if you do not already support anonymous access.</p>
</div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>auth.anonymous<span class="o">]</span>
<span class="nv">enabled</span> <span class="o">=</span> <span class="nb">true</span>
<span class="nv">org_name</span> <span class="o">=</span> Public
<span class="nv">org_role</span> <span class="o">=</span> Viewer

<span class="o">[</span>security<span class="o">]</span>
<span class="nv">allow_embedding</span> <span class="o">=</span> <span class="nb">true</span>
</pre></div>
</div>
<p>The dashboard used by OSC is the <a class="reference external" href="https://grafana.com/grafana/dashboards/12093">OnDemand Clusters</a> dashboard.</p>
<p>Settings used to access Grafana are configured in the cluster config.  The following is an example from OSC:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">custom</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">grafana</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://grafana.osc.edu&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">orgId</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class="w"></span>
<span class="w">    </span><span class="nt">dashboard</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ondemand-clusters&quot;</span><span class="w"></span>
<span class="w">      </span><span class="nt">uid</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;aaba6Ahbauquag&quot;</span><span class="w"></span>
<span class="w">      </span><span class="nt">panels</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span><span class="w"></span>
<span class="w">        </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">24</span><span class="w"></span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">cluster</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cluster&quot;</span><span class="w"></span>
<span class="w">      </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;host&quot;</span><span class="w"></span>
<span class="w">      </span><span class="nt">jobid</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;jobid&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">cluster_override</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mysite&quot;</span><span class="w"></span>
</pre></div>
</div>
<p>When viewing a dashboard in Grafana choose the panel you’d wish to display and select <cite>Share</cite>.
Then choose the <cite>Embed</cite> tab which will provide you with the iframe URL that will need to be generated within OnDemand.
The time ranges and values for labels (eg: <cite>var-cluster=</cite>) will be autofilled by OnDemand.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">orgId</span></code> is the <code class="docutils literal notranslate"><span class="pre">orgId</span></code> query parameter</p></li>
<li><p>The dashboard <code class="docutils literal notranslate"><span class="pre">name</span></code> is the last segment of the URI before query parameters</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">uid</span></code> is the UID portion of URL that is unique to every dashboard</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">panelId</span></code> query parameter will be used as the value for either <code class="docutils literal notranslate"><span class="pre">cpu</span></code> or <code class="docutils literal notranslate"><span class="pre">memory</span></code> depending on the panel you have selected</p></li>
<li><p>The values for <code class="docutils literal notranslate"><span class="pre">labels</span></code> are how OnDemand maps labels in Grafana to values expected in OnDemand. The <code class="docutils literal notranslate"><span class="pre">jobid</span></code> key is optional, the others are required.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">cluster_override</span></code> can override the cluster name used to make requests to Grafana if the Grafana cluster name varies from OnDemand cluster name.</p></li>
</ul>
</div>
<div class="section" id="disable-host-link-in-batch-connect-session-card">
<span id="disable-host-link-batch-connect"></span><h2>Disable Host Link in Batch Connect Session Card<a class="headerlink" href="#disable-host-link-in-batch-connect-session-card" title="Permalink to this headline">¶</a></h2>
<p>Batch connect session cards like this have links to the compute node on which the job is currently running (highlighted).</p>
<div class="figure align-center">
<img alt="_images/bc-card-w-hostlink.png" src="_images/bc-card-w-hostlink.png" />
</div>
<p>However, some sites may want to disable this feature because they do not allow ssh sessions on the compute
nodes.</p>
<p>To disable this, simply set the environment variable in the dashboards’ env file
<code class="docutils literal notranslate"><span class="pre">/etc/ood/config/apps/dashboard/env</span></code> to a falsy value (0, false, off).</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># don&#39;t show ssh link in batch connect card</span>
<span class="nv">OOD_BC_SSH_TO_COMPUTE_NODE</span><span class="o">=</span>off
</pre></div>
</div>
<p>If you wish to disable on a per-cluster basis, you can set the following in your <a class="reference internal" href="installation/cluster-config-schema.html#cluster-config-schema"><span class="std std-ref">cluster YAML configuration</span></a>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">v2</span><span class="p">:</span><span class="w"></span>
<span class="w">   </span><span class="c1"># ...</span><span class="w"></span>
<span class="hll"><span class="w">   </span><span class="nt">batch_connect</span><span class="p">:</span><span class="w"></span>
</span><span class="hll"><span class="w">     </span><span class="nt">ssh_allow</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"></span>
</span></pre></div>
</div>
</div>
<div class="section" id="set-illegal-job-name-characters">
<span id="id17"></span><h2>Set Illegal Job Name Characters<a class="headerlink" href="#set-illegal-job-name-characters" title="Permalink to this headline">¶</a></h2>
<p>If you encounter an issue in running batch connect applications complaining about invalid
job names like the error below.</p>
<p><code class="docutils literal notranslate"><span class="pre">Unable</span> <span class="pre">to</span> <span class="pre">read</span> <span class="pre">script</span> <span class="pre">file</span> <span class="pre">because</span> <span class="pre">of</span> <span class="pre">error:</span> <span class="pre">ERROR!</span> <span class="pre">argument</span> <span class="pre">to</span> <span class="pre">-N</span> <span class="pre">option</span> <span class="pre">must</span> <span class="pre">not</span> <span class="pre">contain</span> <span class="pre">/</span></code></p>
<p>To resolve this set <code class="docutils literal notranslate"><span class="pre">OOD_JOB_NAME_ILLEGAL_CHARS</span></code> to <code class="docutils literal notranslate"><span class="pre">/</span></code> for all OOD applications in the
<code class="docutils literal notranslate"><span class="pre">pun_custom_env</span></code> attribute of the <code class="docutils literal notranslate"><span class="pre">/etc/ood/config/nginx_stage.yml</span></code> file.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># /etc/ood/config/nginx_stage.yml</span><span class="w"></span>
<span class="nt">pun_custom_env</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">OOD_JOB_NAME_ILLEGAL_CHARS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="customize-dex-theme">
<span id="id18"></span><h2>Customize Dex Theme<a class="headerlink" href="#customize-dex-theme" title="Permalink to this headline">¶</a></h2>
<p>It’s possible to use a customized theme when authenticating with Dex when using OnDemand’s default authentication.
Refer to the upstream <a class="reference external" href="https://dexidp.io/docs/templates/">Dex template docs</a> for additional information on templating Dex.</p>
<p>The simplest approach is to copy the OnDemand theme and make changes.  This is idea if you wish to make the following changes:</p>
<ul class="simple">
<li><p>Change navigation or login page logos</p></li>
<li><p>Change favicon</p></li>
<li><p>Change CSS styles</p></li>
</ul>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>cp -r /usr/share/ondemand-dex/web/themes/ondemand /usr/share/ondemand-dex/web/themes/mycenter
</pre></div>
</div>
<p>To update the theme you must modify <code class="docutils literal notranslate"><span class="pre">/etc/ood/config/ood_portal.yml</span></code> and regenerate the Dex configuration:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">dex</span><span class="p">:</span><span class="w"></span>
<span class="c1"># ...</span><span class="w"></span>
<span class="hll"><span class="w">  </span><span class="nt">frontend</span><span class="p">:</span><span class="w"></span>
</span><span class="hll"><span class="w">    </span><span class="nt">theme</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mycenter</span><span class="w"></span>
</span></pre></div>
</div>
<p>The default <code class="docutils literal notranslate"><span class="pre">ondemand</span></code> theme can also be configured using the following configuration keys within <code class="docutils literal notranslate"><span class="pre">/etc/ood/config/ood_portal.yml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">dex</span><span class="p">:</span><span class="w"></span>
<span class="c1"># ...</span><span class="w"></span>
<span class="w">  </span><span class="nt">frontend</span><span class="p">:</span><span class="w"></span>
<span class="hll"><span class="w">    </span><span class="nt">issuer</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;MyCenter</span><span class="nv"> </span><span class="s">OnDemand&quot;</span><span class="w"></span>
</span><span class="hll"><span class="w">    </span><span class="nt">extra</span><span class="p">:</span><span class="w"></span>
</span><span class="hll"><span class="w">      </span><span class="nt">navLogo</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/path/to/custom/nav-logo.png&quot;</span><span class="w"></span>
</span><span class="hll"><span class="w">      </span><span class="nt">loginLogo</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/path/to/custom/logo.png&quot;</span><span class="w"></span>
</span><span class="hll"><span class="w">      </span><span class="nt">loginTitle</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Log</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">your</span><span class="nv"> </span><span class="s">Center</span><span class="nv"> </span><span class="s">username</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">password&quot;</span><span class="w"></span>
</span><span class="hll"><span class="w">      </span><span class="nt">loginButtonText</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Log</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">your</span><span class="nv"> </span><span class="s">Center</span><span class="nv"> </span><span class="s">account&quot;</span><span class="w"></span>
</span><span class="hll"><span class="w">      </span><span class="nt">usernamePlaceholder</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;center-username&quot;</span><span class="w"></span>
</span><span class="hll"><span class="w">      </span><span class="nt">passwordPlaceholder</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;center-password&quot;</span><span class="w"></span>
</span><span class="hll"><span class="w">      </span><span class="nt">loginAlertMessage</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Login</span><span class="nv"> </span><span class="s">services</span><span class="nv"> </span><span class="s">will</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">down</span><span class="nv"> </span><span class="s">during</span><span class="nv"> </span><span class="s">center</span><span class="nv"> </span><span class="s">maintenance</span><span class="nv"> </span><span class="s">between</span><span class="nv"> </span><span class="s">8:00</span><span class="nv"> </span><span class="s">AM</span><span class="nv"> </span><span class="s">EST</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">10:00</span><span class="nv"> </span><span class="s">AM</span><span class="nv"> </span><span class="s">EST&quot;</span><span class="w"></span>
</span><span class="hll"><span class="w">      </span><span class="nt">loginAlertType</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;warning&quot;</span><span class="w"></span>
</span></pre></div>
</div>
<p>Changes are applied by running <code class="docutils literal notranslate"><span class="pre">update_ood_portal</span></code> and restarting the <code class="docutils literal notranslate"><span class="pre">ondemand-dex</span></code> service.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
sudo systemctl restart ondemand-dex.service
</pre></div>
</div>
</div>
<div class="section" id="xdmod-integration">
<span id="id19"></span><h2>XDMoD Integration<a class="headerlink" href="#xdmod-integration" title="Permalink to this headline">¶</a></h2>
<p>XDMoD Integration requires XDMoD 9+, OnDemand 1.8+, and the ability to facilitate single sign on between the two services. Currently this has been demonstrated to work using OpenID Connect via Keycloak as well as a modified instance of Dex Identity Provider to support sessions.</p>
<div class="figure align-center" id="id30">
<img alt="_images/customization_xdmod.png" src="_images/customization_xdmod.png" />
<p class="caption"><span class="caption-number">Fig. 5 </span><span class="caption-text">Example of XDMoD Job Efficiency reports in the OnDemand Dashboard.</span><a class="headerlink" href="#id30" title="Permalink to this image">¶</a></p>
</div>
<p>Steps to enable the XDMoD reports in the OnDemand Dashboard:</p>
<ol class="arabic">
<li><p>Configure OnDemand with XDMoD host URL in PUN /etc/ood/config/nginx_stage.yml</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">pun_custom_env</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">OOD_XDMOD_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://xdmod.osc.edu&quot;</span><span class="w"></span>
</pre></div>
</div>
</li>
<li><p>Add OnDemand host as domain to XDMoD portal settings for CORS /etc/xdmod/portal_settings.ini</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>domains = &quot;https://ondemand.osc.edu&quot;
</pre></div>
</div>
</li>
<li><p>Configure identity provider to include OnDemand host in HTTP <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors">Content-Security-Policy for frame-ancestors</a> since OnDemand uses iFrames to trigger SSO with XDMoD when a user logs in. Below is what we ensured Content-Security-Policy header for frame-ancestors was set to when configuring Keycloak:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>frame-ancestors https://*.osc.edu &#39;self&#39;
</pre></div>
</div>
</li>
<li><p>If you want the XDMoD links in the OnDemand Job Composer you also need to configure OnDemand with XDMoD resource id in each cluster config. For example, in the hpctoolset the resource_id for the hpc cluster is 1 in XDMoD, so we modify /etc/ood/config/clusters.d/hpc.yml to add a xdmod map to the custom map at the bottom of the file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">v2</span><span class="p">:</span><span class="w"></span>
<span class="w"> </span><span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">   </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;HPC</span><span class="nv"> </span><span class="s">Cluster&quot;</span><span class="w"></span>
<span class="w"> </span><span class="nt">login</span><span class="p">:</span><span class="w"></span>
<span class="w">   </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;frontend&quot;</span><span class="w"></span>
<span class="w"> </span><span class="nt">job</span><span class="p">:</span><span class="w"></span>
<span class="w">   </span><span class="nt">adapter</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;slurm&quot;</span><span class="w"></span>
<span class="w">   </span><span class="nt">cluster</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;hpc&quot;</span><span class="w"></span>
<span class="w">   </span><span class="nt">bin</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/usr/bin&quot;</span><span class="w"></span>
<span class="hll"><span class="w"> </span><span class="nt">custom</span><span class="p">:</span><span class="w"></span>
</span><span class="hll"><span class="w">   </span><span class="nt">xdmod</span><span class="p">:</span><span class="w"></span>
</span><span class="hll"><span class="w">     </span><span class="nt">resource_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>
</span></pre></div>
</div>
</li>
<li><p>In the Job Composer, Open XDMoD job links will include a warning message that the job may not appear in XDMoD for up to 24 hours after the job completed. The message is to address the gap of time between the job appearing as completed in the Job Composer and the job appearing in Open XDMoD after the ingest and aggregation script is run. This message appears from the time the Job Composer becomes aware of the job completion status, till an elapsed time specified in seconds by the locale key <code class="docutils literal notranslate"><span class="pre">en.jobcomposer.xdmod_url_warning_message_seconds_after_job_completion</span></code> which defaults to 24 hours (86400 seconds) with a text message specified by locale key  <code class="docutils literal notranslate"><span class="pre">en.jobcomposer.xdmod_url_warning_message</span></code>. To disable this message, set the value you your locale file under <code class="docutils literal notranslate"><span class="pre">/etc/ood/config/locales</span></code>. For example, in the default locale we have these values:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">en</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">jobcomposer</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">xdmod_url_warning_message</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;This</span><span class="nv"> </span><span class="s">job</span><span class="nv"> </span><span class="s">may</span><span class="nv"> </span><span class="s">not</span><span class="nv"> </span><span class="s">appear</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">Open</span><span class="nv"> </span><span class="s">XDMoD</span><span class="nv"> </span><span class="s">until</span><span class="nv"> </span><span class="s">24</span><span class="nv"> </span><span class="s">hours</span><span class="nv"> </span><span class="s">after</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">completion</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">job.&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">xdmod_url_warning_message_seconds_after_job_completion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">86400</span><span class="w"></span>
</pre></div>
</div>
<p>Which results in these warning messages appearing in Job Composer:</p>
<div class="figure align-center">
<img alt="_images/customization_xdmod_jobcomposer_warning_1.png" src="_images/customization_xdmod_jobcomposer_warning_1.png" />
</div>
<div class="figure align-center">
<img alt="_images/customization_xdmod_jobcomposer_warning_2.png" src="_images/customization_xdmod_jobcomposer_warning_2.png" />
</div>
</li>
</ol>
</div>
<div class="section" id="accessing-remote-file-systems">
<span id="remote-file-systems"></span><h2>Accessing Remote File Systems<a class="headerlink" href="#accessing-remote-file-systems" title="Permalink to this headline">¶</a></h2>
<p>Since 2.1 you can use <code class="docutils literal notranslate"><span class="pre">rclone</span></code> to interact with remote file systems.  Since
every command in Open OnDemand is issued <em>as the user</em>, the user themselves
are required to setup their <code class="docutils literal notranslate"><span class="pre">rclone</span></code> remomtes.</p>
<p>You can refer to the <a class="reference external" href="https://www.osc.edu/resources/getting_started/howto/howto_use_rclone_to_upload_data">OSC’s rclone documentation</a> on how to configure rclone
remotes.</p>
<p>To enable this feature ensure that <code class="docutils literal notranslate"><span class="pre">rclone</span></code> is installed on the same machine
that Open OnDemand is installed. You also have to enable the feature through
the <a class="reference internal" href="reference/files/ondemand-d-ymls.html#remote-files-enabled"><span class="std std-ref">configuration entry for enabling remote filesystems</span></a>.</p>
</div>
<div class="section" id="cancel-interactive-sessions">
<h2>Cancel Interactive Sessions<a class="headerlink" href="#cancel-interactive-sessions" title="Permalink to this headline">¶</a></h2>
<p>We can now cancel an interactive session from the session panel without deleting the session card.
This functionality will allow users to remove the job from the scheduler and keep the information in the OnDemand interface.</p>
<p>This feature is disabled behind a feature toggle. To enable it, set the configuration property <code class="docutils literal notranslate"><span class="pre">cancel_session_enabled:</span> <span class="pre">true</span></code>.
For more information on how to configure properties, see <a class="reference internal" href="reference/files/ondemand-d-ymls.html#configuration-properties"><span class="std std-ref">configuration documentation</span></a>.</p>
<p>When enabled, the cancel button will appear for active sessions.
When the session is cancelled, the job will be cancelled in the scheduler,
the status will change to <code class="docutils literal notranslate"><span class="pre">completed</span></code>, and the session card will be kept.
For completed sessions, the system will only show the delete button.</p>
<div class="figure align-center">
<img alt="_images/cancel_session.png" src="_images/cancel_session.png" />
</div>
</div>
<div class="section" id="custom-pages">
<span id="custom-pages-guide"></span><h2>Custom Pages<a class="headerlink" href="#custom-pages" title="Permalink to this headline">¶</a></h2>
<p>Custom pages allow administrators to add custom content to new dashboard pages.
These new pages are configured using layouts and widgets, in the same way as
<a class="reference internal" href="#dashboard-custom-layout"><span class="std std-ref">customizing the layout for the dashboard</span></a>.</p>
<p>To create a custom page, add a layout under a new <code class="docutils literal notranslate"><span class="pre">page_code</span></code> to the <code class="docutils literal notranslate"><span class="pre">custom_pages</span></code> property object.
For more information on how to setup dashboard properties, see <a class="reference internal" href="reference/files/ondemand-d-ymls.html#ondemand-d-ymls"><span class="std std-ref">OnDemand configuration files</span></a></p>
<p>Custom pages have their own URL based on their <code class="docutils literal notranslate"><span class="pre">page_code</span></code>: <code class="docutils literal notranslate"><span class="pre">/sys/pun/dashboard/custom/page_code</span></code>.</p>
<p>The example configuration below creates a custom page with the page_code: <code class="docutils literal notranslate"><span class="pre">documentation</span></code>.
It will render a layout with the <code class="docutils literal notranslate"><span class="pre">pinned_apps</span></code> widget under the URL: <code class="docutils literal notranslate"><span class="pre">/sys/pun/dashboard/custom/documentation</span></code>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">custom_pages</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">documentation</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">rows</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">columns</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">width</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">12</span><span class="w"></span>
<span class="w">            </span><span class="nt">widgets</span><span class="p">:</span><span class="w"></span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;pinned_apps&quot;</span><span class="w"></span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="_images/custom-pages-documentation.png" src="_images/custom-pages-documentation.png" />
</div>
<p>Links to the custom pages can be added the Help dropdown menu.
To add links to the Help menu use the configuration property <code class="docutils literal notranslate"><span class="pre">help_menu</span></code>.
See the <a class="reference internal" href="#help-menu-guide"><span class="std std-ref">documentation on adding urls to the Help menu</span></a> for details and examples.</p>
<p>Adding custom pages links uses the same notation and attributes as when created for the custom Dashboard navbar.
See <a class="reference internal" href="#menus-for-custom-pages"><span class="std std-ref">How to add menus for custom pages</span></a>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Adding a link to the custom page with page_code = &quot;documentation&quot;</span><span class="w"></span>
<span class="nt">help_menu</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Custom</span><span class="nv"> </span><span class="s">Pages&quot;</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">page</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;documentation&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Site</span><span class="nv"> </span><span class="s">Documentation&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">icon</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;fas://book&quot;</span><span class="w"></span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="_images/def-page-links.png" src="_images/def-page-links.png" />
</div>
</div>
<div class="section" id="support-tickets">
<span id="support-ticket-guide"></span><h2>Support Tickets<a class="headerlink" href="#support-tickets" title="Permalink to this headline">¶</a></h2>
<p>The Dashboard now supports sending a support ticket to your institution Help Desk system.
The feature uses email as the delivery mechanism, but it could be extended to support others.</p>
<p>To enable this feature, define the settings needed using the the configuration property <code class="docutils literal notranslate"><span class="pre">support_ticket</span></code>.
Once this configuration object is defined, the <code class="docutils literal notranslate"><span class="pre">Submit</span> <span class="pre">Support</span> <span class="pre">Ticket</span></code> link will be shown in the <code class="docutils literal notranslate"><span class="pre">Help</span></code> navigation menu
and in all interactive session cards.</p>
<div class="figure align-center">
<img alt="_images/support_ticket_menu.png" src="_images/support_ticket_menu.png" />
</div>
<p>The support ticket page has a simple form to gather information that will be submitted to the support system via email.
If triggered from a session card, the system will automatically add information about the selected
session to the body of the email to help troubleshoot the issue.</p>
<div class="figure align-center">
<img alt="_images/support_ticket_form.png" src="_images/support_ticket_form.png" />
</div>
<p>A brief description of the default form fields used in the support ticket form:</p>
<ul class="simple">
<li><p><strong>Username:</strong> Logged in user. Username will be added to the support ticket body for reference.</p></li>
<li><p><strong>Email:</strong> Email address to communicate regarding this support ticket. A single email address is supported.</p></li>
<li><p><strong>CC:</strong> Additional email address to communicate regardig this ticket. A single email address is supported.</p></li>
<li><p><strong>Subject:</strong> Brief description of the problem.</p></li>
<li><p><strong>Attachments:</strong> Add screeshots of the problem to help with debugging and troubleshooting.</p></li>
<li><p><strong>Description:</strong> Detail description of the problem.</p></li>
</ul>
<div class="section" id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h3>
<p>These are the most common configuration properties needed to enable and setup the support ticket feature:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">description</span></code>: Text to customize the support ticket header. It supports HTML.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">from</span></code>: The email address to set the email from field when sending the email. It defaults to the email field set in the form.
This is useful to prevent the incoming emails being considered spam.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">to</span></code>: The destination email address of your Help Desk.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">delivery_method</span></code>: Rails setting to set the transport mechanism to use. This is usually <code class="docutils literal notranslate"><span class="pre">smtp</span></code>.
For more information see the <a class="reference external" href="https://guides.rubyonrails.org/action_mailer_basics.html#action-mailer-configuration">Rails documentation on mailers</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">delivery_settings</span></code>: Rails settings object to set the transport configuration properties.
See example below or the <a class="reference external" href="https://guides.rubyonrails.org/action_mailer_basics.html#action-mailer-configuration">Rails documentation on mailers</a>.</p></li>
</ul>
<p>Sample configuration:</p>
<blockquote>
<div><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">support_ticket</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">email</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="c1"># Optional.</span><span class="w"></span>
<span class="w">    </span><span class="c1"># Text/HTML added to the page under the support ticket header</span><span class="w"></span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="w"></span>
<span class="w">      </span><span class="no">&lt;strong&gt;My Description Text&lt;/strong&gt;&lt;br /&gt;</span><span class="w"></span>
<span class="w">      </span><span class="no">This is a description text for the frontend with HTML support</span><span class="w"></span>
<span class="w">    </span><span class="c1"># Optional.</span><span class="w"></span>
<span class="w">    </span><span class="c1"># To set the email from field. Defaults to the email set in the form.</span><span class="w"></span>
<span class="w">    </span><span class="nt">from</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;config@example.com&quot;</span><span class="w"></span>
<span class="w">    </span><span class="c1"># Required.</span><span class="w"></span>
<span class="w">    </span><span class="c1"># Your support system email address. The email will be sent to this address</span><span class="w"></span>
<span class="w">    </span><span class="nt">to</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;support@support.system.com&quot;</span><span class="w"></span>
<span class="w">    </span><span class="c1"># delivery_method and delivery_settings are Rails configuration items</span><span class="w"></span>
<span class="w">    </span><span class="c1"># that can be set in this file to simplify configuration.</span><span class="w"></span>
<span class="w">    </span><span class="c1"># If you prefer, you can configure Rails in the usual way.</span><span class="w"></span>
<span class="w">    </span><span class="nt">delivery_method</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;smtp&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">delivery_settings</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;smtp.gmail.com&#39;</span><span class="w"></span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">587</span><span class="w"></span>
<span class="w">      </span><span class="nt">domain</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;example.com&#39;</span><span class="w"></span>
<span class="w">      </span><span class="nt">user_name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&lt;username&gt;&#39;</span><span class="w"></span>
<span class="w">      </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&lt;password&gt;&#39;</span><span class="w"></span>
<span class="w">      </span><span class="nt">authentication</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;plain&#39;</span><span class="w"></span>
<span class="w">      </span><span class="nt">enable_starttls_auto</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">      </span><span class="nt">open_timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15</span><span class="w"></span>
<span class="w">      </span><span class="nt">read_timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id21">
<h3>Customizations<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h3>
<p>The support ticket form can be customized using the <code class="docutils literal notranslate"><span class="pre">form</span></code> and <code class="docutils literal notranslate"><span class="pre">attributes</span></code> configuration properties.
In the same way that you can configure the <a class="reference internal" href="enable-desktops/modify-form-attributes.html#enable-desktops-modify-form-attributes"><span class="std std-ref">form for interactive applications</span></a>,
the support ticket form fields can be arranged or changed as required.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please note that an <code class="docutils literal notranslate"><span class="pre">email</span></code> field must be present in the form for the support ticket feature to be functional.</p>
</div>
<p>Custom fields can be added, but they will require a custom email template to make use of the provided values in the email body.
Override the default email template with your own by dropping a file named <code class="docutils literal notranslate"><span class="pre">_email.text.erb</span></code> into the folder
<code class="docutils literal notranslate"><span class="pre">/etc/ood/config/apps/dashboard/views/support_ticket/email/</span></code></p>
<p>The example below shows a custom form configuration with 3 fields and how to use them in the template to generate the email body.</p>
<blockquote>
<div><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">support_ticket</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">attributes</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">email</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">    </span><span class="nt">subject</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;OnDemand</span><span class="nv"> </span><span class="s">Problem:</span><span class="nv"> </span><span class="s">&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">form</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">email</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">subject</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">department</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># /etc/ood/config/apps/dashboard/views/support_ticket/email/_email.text.erb</span>
<span class="n">Email</span> <span class="n">Intro</span>
<span class="n">Department</span><span class="p">:</span> <span class="o">&lt;%=</span> <span class="nd">@context</span><span class="o">.</span><span class="n">support_ticket</span><span class="o">.</span><span class="n">department</span> <span class="o">%&gt;</span>
<span class="n">Subject</span> <span class="n">Copy</span><span class="p">:</span> <span class="o">&lt;%=</span> <span class="nd">@context</span><span class="o">.</span><span class="n">support_ticket</span><span class="o">.</span><span class="n">subject</span> <span class="o">%&gt;</span>

<span class="n">Other</span> <span class="n">static</span> <span class="n">data</span><span class="o">.</span>
</pre></div>
</div>
</div></blockquote>
<div class="figure align-center">
<img alt="_images/support_ticket_custom_form.png" src="_images/support_ticket_custom_form.png" />
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="how-tos/debug.html" class="btn btn-neutral float-right" title="Debugging and Monitoring" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="how-tos/app-development/interactive/setup/enable-reverse-proxy.html" class="btn btn-neutral float-left" title="3. Enable Reverse Proxy" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017-2023, Ohio Supercomputer Center

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Documentation Versions</span>
    v: 
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Versions</dt>
      
        <dd><a href="https://OSC.github.io/ood-documentation/latest/customizations.html">latest</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-2.0/customizations.html">2.0</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.8/customizations.html">1.8</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.7/customizations.html">1.7</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.6/customizations.html">1.6</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.5/customizations.html">1.5</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.4/customizations.html">1.4</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.3/customizations.html">1.3</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.2/customizations.html">1.2</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.1/customizations.html">1.1</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.0/customizations.html">1.0</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/develop/customizations.html">develop</a></dd>
      
    </dl>
    <dl>
      <dt>On GitHub</dt>
        <dd>
          <a href="http://openondemand.org/">Website</a>
        </dd>
        <dd>
          <a href="https://github.com/OSC/Open-OnDemand">Main Repo</a>
        </dd>
    </dl>
    <hr/>
    Theme provided by <a href="http://www.readthedocs.org">Read the Docs</a>.
  </div>
</div>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>