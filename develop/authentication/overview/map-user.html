

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2. Setup User Mapping &mdash; Open OnDemand 1.6.3 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Open OnDemand 1.6.3 documentation" href="../../index.html"/>
        <link rel="up" title="Overview" href="../overview.html"/>
        <link rel="next" title="OpenID Connect via KeyCloak on RHEL7" href="../tutorial-oidc-keycloak-rhel7.html"/>
        <link rel="prev" title="1. Configure Apache Authentication" href="configure-authentication.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/logo.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                1.6
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Install</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../authentication.html">Authentication</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../overview.html">Overview</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="configure-authentication.html">1. Configure Apache Authentication</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">2. Setup User Mapping</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#custom-mapping">2.1. Custom Mapping</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial-oidc-keycloak-rhel7.html">OpenID Connect via KeyCloak on RHEL7</a></li>
<li class="toctree-l2"><a class="reference internal" href="../duo-2fa-with-keycloak.html">Two Factor Auth using Duo with Keycloak</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../installation/add-cluster-config.html">Add Cluster Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation/resource-manager.html">Resource Manager Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../customization_overview.html">Customization Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../customization.html">Customization</a></li>
</ul>
<p class="caption"><span class="caption-text">Extend</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../app-development/interactive/setup.html">Setup Interactive Apps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../enable-desktops.html">Enable Interactive Desktop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install-ihpc-apps.html">Install Other Interactive Apps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app-development.html">App Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app-sharing.html">App Sharing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app-development/tutorials-interactive-apps.html">Tutorials: Interactive Apps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app-development/tutorials-passenger-apps.html">Tutorials: Passenger Apps</a></li>
</ul>
<p class="caption"><span class="caption-text">Release Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes/v1.5-release-notes.html">v1.5 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes/v1.4-release-notes.html">v1.4 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes/v1.3-release-notes.html">v1.3 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes/v1.2-release-notes.html">v1.2 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes/v1.1-release-notes.html">v1.1 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes/v1.0-release-notes.html">v1.0 Release Notes</a></li>
</ul>
<p class="caption"><span class="caption-text">Legacy Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../infrastructure.html">Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../applications.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user-documentation.html">User Documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Open OnDemand</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../authentication.html">Authentication</a> &raquo;</li>
        
          <li><a href="../overview.html">Overview</a> &raquo;</li>
        
      <li>2. Setup User Mapping</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/OSC/ood-documentation/blob/develop/source/authentication/overview/map-user.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="setup-user-mapping">
<span id="authentication-overview-map-user"></span><h1>2. Setup User Mapping<a class="headerlink" href="#setup-user-mapping" title="Permalink to this headline">¶</a></h1>
<p>Every HTTP request sent to the OnDemand portal triggers a call to the
<a class="reference internal" href="../../infrastructure/ood-auth-map.html#ood-auth-map"><span class="std std-ref">ood_auth_map</span></a> script to map the remote authenticated user name to the
local system user name. Mapping to the local system user not only restricts
access of OnDemand to local users but it is also required by the OnDemand proxy
to traffic the HTTP data to the user’s corresponding per-user NGINX (PUN)
server.</p>
<p>The <a class="reference internal" href="../../infrastructure/ood-portal-generator.html#ood-portal-generator"><span class="std std-ref">ood-portal-generator</span></a> and its corresponding
<a class="reference internal" href="../../infrastructure/ood-portal-generator/configuration.html#ood-portal-generator-configuration"><span class="std std-ref">Configuration</span></a> are used to configure both the system
command that performs the mapping (<a class="reference internal" href="../../infrastructure/ood-portal-generator/configuration.html#ood-portal-generator-user-map-cmd"><span class="std std-ref">user_map_cmd</span></a>) and the argument fed to the system
command (<a class="reference internal" href="../../infrastructure/ood-portal-generator/configuration.html#ood-portal-generator-user-env"><span class="std std-ref">user_env</span></a>). By default these
configuration options are defined as:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># /etc/ood/config/ood_portal.yml</span>
<span class="nn">---</span>
<span class="c1"># ...</span>
<span class="l l-Scalar l-Scalar-Plain">user_map_cmd</span><span class="p p-Indicator">:</span> <span class="s">&#39;/opt/ood/ood_auth_map/bin/ood_auth_map.regex&#39;</span>
<span class="l l-Scalar l-Scalar-Plain">user_env</span><span class="p p-Indicator">:</span> <span class="s">&#39;REMOTE_USER&#39;</span>
</pre></div>
</div>
<p>which uses <a class="reference internal" href="../../infrastructure/ood-auth-map.html#ood-auth-map"><span class="std std-ref">ood_auth_map</span></a> for the mapping command and <code class="docutils literal notranslate"><span class="pre">REMOTE_USER</span></code>
(this variable holds the name of the authenticated user by the web server) as
its command line argument.</p>
<p>This is equivalent to calling from the command line:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>/opt/ood/ood_auth_map/bin/ood_auth_map.regex <span class="s2">&quot;</span><span class="nv">$REMOTE_USER</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>which just echos back the value of <code class="docutils literal notranslate"><span class="pre">REMOTE_USER</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The default user mapping employed by an OnDemand portal <strong>directly</strong> maps
the remote authenticated user name to the local user name. So the Apache
authentication module used is expected to set the correct local user name in
<code class="docutils literal notranslate"><span class="pre">REMOTE_USER</span></code>.</p>
</div>
<div class="section" id="custom-mapping">
<h2>2.1. Custom Mapping<a class="headerlink" href="#custom-mapping" title="Permalink to this headline">¶</a></h2>
<p>As mentioned previously the <a class="reference internal" href="../../infrastructure/ood-portal-generator.html#ood-portal-generator"><span class="std std-ref">ood-portal-generator</span></a> configuration options
of interest are:</p>
<ul class="simple">
<li><a class="reference internal" href="../../infrastructure/ood-portal-generator/configuration.html#ood-portal-generator-user-map-cmd"><span class="std std-ref">user_map_cmd</span></a></li>
<li><a class="reference internal" href="../../infrastructure/ood-portal-generator/configuration.html#ood-portal-generator-user-env"><span class="std std-ref">user_env</span></a></li>
</ul>
<p>It is recommended you read the discussion on <a class="reference internal" href="../../infrastructure/ood-auth-map.html#ood-auth-map"><span class="std std-ref">ood_auth_map</span></a> before
modifying these values.</p>
<p>After modifying <code class="file docutils literal notranslate"><span class="pre">/etc/ood/config/ood_portal.yml</span></code> with the mapping you
want you would then build and install the new Apache configuration file with:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal
</pre></div>
</div>
<p>Finally you will need to restart your Apache HTTP Server for the changes to
take effect.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../tutorial-oidc-keycloak-rhel7.html" class="btn btn-neutral float-right" title="OpenID Connect via KeyCloak on RHEL7" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="configure-authentication.html" class="btn btn-neutral" title="1. Configure Apache Authentication" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017-2019, Ohio Supercomputer Center.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Documentation Versions</span>
    v: 
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Versions</dt>
      
        <dd><a href="https://OSC.github.io/ood-documentation/master/authentication/overview/map-user.html">master</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.6/authentication/overview/map-user.html">1.6</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.5/authentication/overview/map-user.html">1.5</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.4/authentication/overview/map-user.html">1.4</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.3/authentication/overview/map-user.html">1.3</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.2/authentication/overview/map-user.html">1.2</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.1/authentication/overview/map-user.html">1.1</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.0/authentication/overview/map-user.html">1.0</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/develop/authentication/overview/map-user.html">develop</a></dd>
      
    </dl>
    <dl>
      <dt>On GitHub</dt>
        <dd>
          <a href="http://openondemand.org/">Website</a>
        </dd>
        <dd>
          <a href="https://github.com/OSC/Open-OnDemand">Main Repo</a>
        </dd>
    </dl>
    <hr/>
    Theme provided by <a href="http://www.readthedocs.org">Read the Docs</a>.
  </div>
</div>

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.6.3',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>